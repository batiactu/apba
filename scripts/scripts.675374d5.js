"use strict";angular.module("baLogs",["ngRoute","ui-notification"]).config(["$routeProvider","NotificationProvider",function(a,b){b.setOptions({delay:4e3,startTop:20,startRight:10,verticalSpacing:20,horizontalSpacing:20,positionX:"right",positionY:"top"}),a.when("/logs",{templateUrl:"views/baLogs.html",controller:"LogsCtrl"})}]).controller("LogsCtrl",["$scope","baLogs",function(a,b){a.logs=b}]).factory("baLogs",["Notification",function(a){var b={active:!0,logList:[],config:null,setConfig:function(a){this.config=a},activate:function(){this.log("Logs activés"),this.active=!0},unactivate:function(){this.active=!1,this.log("Logs désactivé")},log:function(){if(null!=this.config&&this.config.logs.debug){var a="Info";"string"==typeof arguments[1]&&-1!=["INFO","WARN","ERROR","DEBUG"].indexOf(arguments[1])&&(a=arguments[1]);if(this.active)for(var b=Date.now()/1e3|0,c=0;c<arguments.length;c++)"string"==typeof arguments[c]&&this.logList.unshift({date:b,type:a,message:arguments[c]})}},debug:function(a){null!=this.config&&"undefined"!=typeof this.config.logs.debug&&this.config.logs.debug&&this.log(a,"DEBUG")},error:function(a){this.log(a,"ERROR")},info:function(a){this.log(a,"INFO")},warning:function(a){this.log(a,"WARN")},notif_error:function(b){"string"==typeof b&&(b={message:b}),a.error(b)},notif_success:function(b){"string"==typeof b&&(b={message:b}),a.success(b)},notif_warning:function(b){"string"==typeof b&&(b={message:b}),a.warning(b)}};return b}]),angular.module("baTraduction",["baLogs"]).filter("baTranslate",["baTraduction",function(a){return function(b,c){return null!=a.listTraduction&&void 0!=a.listTraduction.trad&&void 0!=a.listTraduction.trad[b]&&""!=a.listTraduction.trad[b]?(("DESC"==b||"ASC"==b)&&(b=c+"_"+b),"0"==b&&(b="1"),a.listTraduction.trad[b]):b}}]).factory("baTraduction",["baLogs","$q","$http",function(a,b,c){var d={listTraduction:null,config:null,setConfig:function(a){this.config=a},getTraduction:function(){var a=this,d=b.defer(),e=a.config.traduction.protocoleWeb+a.config.traduction.UrlTrad.replace("#CODELANG#",a.config.traduction.lang);return a.config.loader.loading=!0,c.get(e).then(function(a,b){d.resolve(a.data)},function(b){a.config.logs.debug&&(console.log("erreur sur url "+e),console.log(b))})["finally"](function(){a.config.loader.loading=!1}),d.promise},majTrad:function(a){if(void 0!=a){var b=a();null!=b&&(d.listTraduction=b)}var c=d.getTraduction();c.then(function(b){null==d.listTraduction?d.listTraduction=b:void 0!=d.listTraduction.version&&void 0!=b.version&&d.listTraduction.version<b.version&&(d.config.logs.debug&&console.log("Nouvelle version du fichier : "+b.version),d.listTraduction=b),a(d.listTraduction)})}};return d}]),angular.module("webStorage",[]).factory("webStorage",function(){var a={set:function(a,b){localStorage.setItem(a,JSON.stringify(b))},get:function(a){var b=localStorage.getItem(a);if(void 0==b||null==b)return null;var c=null;try{c=JSON.parse(b)}catch(d){}return c},clearAll:function(){localStorage.clear()},getQty:function(){var a=0;return angular.forEach(localStorage,function(b){a+=b.length}),a}};return a}),angular.module("synchro",["webStorage","baLogs"]).factory("synchro",["webStorage","$q","baLogs",function(a,b,c){var d={listeSynchro:[],config:null,dateSynchro:function(){return Date.now()/1e3|0},setConfig:function(a){this.config=a},isStorageEnable:function(){return this.isActive()&&1==this.config.synchro.storageEnable&&"string"==typeof this.config.synchro.storageType},init:function(a){var b=this;"undefined"!=typeof a&&(b.config=a),b.isActive()&&angular.forEach(b.config.synchro.links,function(a){var c=null;if(null==c){var d=a.callback(a);if(b.listeSynchro[a.name]=d,b.isStorageEnable()&&void 0!=d&&(void 0==a.specificStorage||1!=a.specificStorage)){b.storageSet(a.name,d,!0);var e=b.dateSynchro();b.setConf("lastSynchro",e),void 0!=a.setTimeSynchro&&0!=a.setTimeSynchro&&(b.timeSynchro=a.setTimeSynchro)}}})},resynchronize:function(a,b){var c=this;"undefined"!=typeof b&&(c.config=b),c.isActive()&&angular.forEach(c.config.synchro.links,function(b){if(b.name==a){var d=null,e=c.get(b.name);if(null==d){var f=b.callback(b);if(null!=f&&f.then(function(){c.listeSynchro[b.name]=f},function(){c.listeSynchro[b.name]=e}),c.isStorageEnable()&&void 0!=f&&(void 0==b.specificStorage||1!=b.specificStorage)){null!=f&&f.then(function(){c.storageSet(b.name,f,!0)},function(){c.storageSet(b.name,e,!0)});var g=c.dateSynchro();c.setConf("lastSynchro",g),void 0!=b.setTimeSynchro&&0!=b.setTimeSynchro&&(c.timeSynchro=b.setTimeSynchro)}}}})},storageSet:function(b,c,d){"undefined"==typeof d&&(d=!0);switch(this.config.synchro.storageType){case"W":d?c.then(function(c){a.set(b,c)}):a.set(b,c);break;case"P":}},storageGet:function(b){switch(d.config.synchro.storageType){case"W":return a.get(b);case"P":}},storageClearAll:function(){var b=this;switch(b.config.synchro.storageType){case"W":return a.clearAll();case"P":}},storageQty:function(){var b=this;switch(b.config.synchro.storageType){case"W":return a.getQty();case"P":}},isActive:function(){return null==this.config||"undefined"==typeof this.config.synchro||"undefined"==typeof this.config.synchro.enabled||1!=this.config.synchro.enabled||"undefined"==typeof this.config.synchro.links||0==this.config.synchro.links.length?!1:!0},getConf:function(a){if(this.isStorageEnable()){var b=this.storageGet("conf_"+a);return b}},get:function(a,b){var c=this;if("undefined"!=typeof c.listeSynchro[a]&&null!=c.listeSynchro[a])return c.listeSynchro[a];if(c.isStorageEnable()){var d=c.storageGet(a);if("undefined"!=typeof d&&null!=d){void 0!=b&&void 0!=d[b]&&(d=d[b].obj);var e=c.getPromise(d);return c.listeSynchro[a]=e,e}}return null},getPromise:function(a){var c=b.defer();return c.resolve(a),c.promise},setConf:function(a,b){if(this.isStorageEnable()){this.storageSet("conf_"+a,b,!1)}},set:function(a,b,c){var d,e;if(void 0!=c){void 0==c.promise?(d=this.getPromise(c),e=c):(d=c.promise,e=c.obj),void 0==this.listeSynchro[a]&&(this.listeSynchro[a]=[]),this.listeSynchro[a][b]=d;var f=this.storageGet(a);null==f&&(f=[]),void 0==f&&(f=[]),f[b]=e,this.storageSet(a,f,!1)}else void 0==b.promise?(d=this.getPromise(b),e=b):(d=b.promise,e=b.obj),this.listeSynchro[a]=d,this.storageSet(a,e,!1)},clearAll:function(){this.storageClearAll(),this.listeSynchro=[]},getStockageQty:function(){var a={stockage:"NC",memoire:"NC"};return this.isStorageEnable()&&(a.stockage=this.storageQty()),this.isActive()&&(a.memoire=this.memoryQty()),a},memoryQty:function(){return c.log(window.performance.memory),0},reSync:function(){var a=this,b={};angular.forEach(a.config.synchro.noSyncList,function(c){b[c]=a.storageGet(c)}),this.clearAll(),angular.forEach(a.config.synchro.noSyncList,function(c){a.storageSet(c,b[c],!1)}),this.init(),this.setConf("lastSynchro",this.dateSynchro())},getInfoSynchro:function(){var a=this.getConf("lastSynchro");return a}};return d}]),angular.module("baConfig",["baLogs"]).factory("baConfig",["baLogs","$q","$http",function(a,b,c){var d={config:null,configExtPromise:null,setConfig:function(a){this.config=a},getConfig:function(){var a=this,d=b.defer();if(null!=a.configExtPromise)return a.configExtPromise;var e=this.config.extConfig.protocoleWeb+this.config.extConfig.Url;return a.config.loader.loading=!1,c.get(e).then(function(a,b){d.resolve(a.data)},function(b){a.config.logs.debug&&(console.log("erreur sur url "+e),console.log(b))})["finally"](function(){a.config.loader.loading=!1}),a.configExtPromise=d.promise,d.promise}};return d}]),angular.module("phonegapModule",[]).factory("baPhoneGap",["baLogs","synchro","$q",function(a,b,c){var d={connected:!1,connectFailed:!1,mediaRec:{obj:null,file:null,infos:null},config:null,_connection:{state:0,minDebit:!1,label:"Connexion inconnue"},mediaSyncInProgress:!1,messageInProgress:"hello ....",fileEntry:null,nativeURL:"",setConfig:function(a){this.config=a},isDevice:function(){return"object"==typeof window.cordova?(a.log("C'EST UN DEVICE"),!0):(a.log("CE N'EST PAS UN DEVICE"),!1)},deviceReady:function(a){"object"==typeof window.cordova&&document.addEventListener("deviceready",function(){"undefined"!=typeof a&&a()},!1)},isIOS:function(){return this.isDevice()&&"IOS"==device.platform.toUpperCase()},isAndroid:function(){return this.isDevice()&&"Android"==device.platform},isConnected:function(){var b=this,c=b.checkConnection();return b.connectFailed=b.connectFailed||1==b.connected&&0==c.state,b.connected=1==c.state,a.log("Est connecté : ",b.connected),b.connected},checkConnection:function(){var a=this;if(!a.isDevice())return{state:1,label:"WEB connection",minDebit:!1};if("object"==typeof window.cordova){a.config.logs.debug&&console.log(navigator.network.connection.type);var b=navigator.network.connection.type,c={};return c[Connection.UNKNOWN]={state:1,minDebit:!1,label:"Unknown connection"},c[Connection.ETHERNET]={state:1,minDebit:!0,label:"Ethernet connection"},c[Connection.WIFI]={state:1,minDebit:!0,label:"WiFi connection"},c[Connection.CELL_2G]={state:1,minDebit:!1,label:"Cell 2G connection"},c[Connection.CELL_3G]={state:1,minDebit:!0,label:"Cell 3G connection"},c[Connection.CELL_4G]={state:1,minDebit:!0,label:"Cell 4G connection"},c[Connection.CELL]={state:1,minDebit:!0,label:"Cellular connection"},c[Connection.NONE]={state:0,minDebit:!1,label:"No network connection"},c[b]}return a._connection},minDebitToTransfert:function(){var a=this,b=a.checkConnection();return b.minDebit},captureImageFromCamera:function(b){var c=this;this.deviceReady(function(){navigator.device.capture.captureImage(function(d){void 0!=b&&void 0!=b.funcOk&&(b.funcOk(),delete b.funcOk),a.log(d[0].localURL),c.processFile(d[0].localURL,c.config.media.MEDIA_TYPE_IMAGE,b)},c.errorHandler)})},captureImageProGallery:function(b){var c=this;this.deviceReady(function(){window.imagePicker.getPictures(function(d){a.log(d);for(var e=0,f=0;f<d.length;f++)a.log("Image URI: "+d[f]),c.processFile(d[f],c.config.media.MEDIA_TYPE_IMAGE,b),e++;e&&void 0!=b&&void 0!=b.funcOk&&(b.funcOk(),delete b.funcOk)},function(b){a.log("Error: "+b)})})},playAudio:function(a){var b=this;this.deviceReady(function(){var c=a;b.litAudio(c)})},litAudio:function(a){var b=this;this.deviceReady(function(){var c=a;null!=b.mediaRec.obj&&b.stopAudio(),b.createMedia(c),b.mediaRec.obj.play()})},stopAudio:function(){var a=this;this.deviceReady(function(){null!=a.mediaRec.obj&&(a.mediaRec.obj.stop(),a.mediaRec.obj.release(),a.mediaRec.obj=null,a.mediaRec.file=null)})},captureAudio:function(b){var c=this;this.deviceReady(function(){a.log("Commencement enregistrement");var d=".wav";c.isAndroid()?d=".3gp":c.isIOS()&&(d=".wav");var e="cdvfile://localhost/persistent/"+c.config.media.directory+"/"+c.config.audio.directory+"/"+c.config.audio.prefix+"-"+c.getDateName()+d;c.createMedia(e),c.mediaRec.info=b,c.mediaRec.file=e,c.mediaRec.obj.startRecord()})},stopRecordAudio:function(b){var c=this;this.deviceReady(function(){a.log("Audio() : StopRecordAudio "),c.mediaRec.obj.stopRecord(),c.mediaRec.obj.release(),c.mediaRec.obj=null})},verifRecordAudio:function(){var b=this;this.deviceReady(function(){a.log("Audio() : VerifRecordAudio "),null!=b.mediaRec.obj?(b.mediaRec.obj.getCurrentPosition(function(a){},function(a){}),b.mediaRec.obj.play()):(b.createMedia(b.mediaRec.file),b.mediaRec.obj.play())})},pauseRecordAudio:function(){var b=this;this.deviceReady(function(){a.log("Audio() : PauseRecordAudio "),null!=b.mediaRec.obj&&b.mediaRec.obj.pause()})},validRecordAudio:function(b){var c=this;this.deviceReady(function(){a.log("Audio() : validRecordAudio "),null!=c.mediaRec.obj&&(c.mediaRec.obj.stop(),c.mediaRec.obj.release(),c.mediaRec.obj=null),c.processFile(c.mediaRec.file,c.config.media.MEDIA_TYPE_AUDIO,b)})},getPosition:function(a){var b=this;null!=b.mediaRec.obj&&b.mediaRec.obj.getCurrentPosition(a)},getDuration:function(a){var b=this;return b.mediaRec.obj?b.mediaRec.obj.getDuration():-1},createMedia:function(b,c){var d=this;this.deviceReady(function(){d.mediaRec.obj=new Media(b,function(){a.log("createMedia() : Audio Success"),"function"==typeof c&&c()},function(b){a.log("createMedia(): Audio Error : "+b)},function(b){a.log("createMedia(): Audio Status : ",b)})})},getDateName:function(){var a=new Date,b=a.getTime();return b},processFile:function(b,c,d){var e=this;this.deviceReady(function(){e.config.logs.debug&&console.log("MediaFileURL = ",b),window.resolveLocalFileSystemURL(b,function(b){e.moveFileToLocalDir(b,c,function(f){a.log("fin deplacement",b.name," --> ",f.name),f.type=c,e.transfert(f,d)})},e.resOnError)})},storageSetAddToList:function(a,c){var d=this;d.config.logs.debug&&console.log(a,c);var e=b.storageGet(a);null==e&&(e=[]),e.push(c),b.storageSet(a,e,!1)},storageSetDelToList:function(a,c){var d=this,e=b.storageGet(a);null==e&&(e=[]);var f=[];angular.forEach(e,function(a){d.config.logs.debug&&console.log("verif pour supp localto sync : ",a.name!=c,a.name,c),a.name!=c&&f.push(a)}),b.storageSet(a,f,!1)},storageGetListToSynchronize:function(a){return b.storageGet(a)},synchronizeMedia:function(b,c){var d=this;this.deviceReady(function(){if(d.mediaSyncInProgress)return void a.log("Synchro media déjà en cours");if(d.mediaSyncInProgress=!0,a.log("Synchro média : en cours  : "),"string"!=typeof b&&(b=d.config.media.synchroName),1==c||d.minDebitToTransfert()||1!=d.config.media.useSynchro){var e=d.storageGetListToSynchronize(b);null==e||0==e.length?a.log("---------------> rien à faire"):(a.log("---------------> début transfert"),angular.forEach(e,function(a){d.config.logs.debug&&console.log("Valeur dans synchro",a),d.transfert(a,a.infos,!0)}))}else a.log("Connexion insuffisante"),a.notif_warning("Synchronisation des fichiers en attente : connexion insuffisante");d.mediaSyncInProgress=!1})},moveFileToLocalDir:function(b,c,d){var e=this,f=new Date,g=(f.getTime(),""),h=e.config.media.directory+"/";this.deviceReady(function(){switch(c){case e.config.media.MEDIA_TYPE_IMAGE:g=e.config.photo.prefix+"-"+e.getDateName()+".jpg",h+=e.config.photo.directory;break;case e.config.media.MEDIA_TYPE_AUDIO:var f=".wav";e.isAndroid()?f=".3gp":e.isIOS()&&(f=".wav"),g=e.config.audio.prefix+"-"+e.getDateName()+f,h+=e.config.audio.directory}e.config.logs.debug&&(console.log("type = ",c),console.log("newFileName = ",g),console.log("myFolderApp = ",h)),""!=g?window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(a){a.root.getDirectory(h,{create:!0,exclusive:!1},function(a){e.config.logs.debug&&console.log(a),b.moveTo(a,g,function(a){e.config.logs.debug&&console.log("+++++",a),d(a)},function(){e.config.logs.debug&&console.log("ERR+++++",arguments)})},e.errorHandler)},e.errorHandler):a.log("Error name File : empty for temporary file : "+b.fullPath)})},createFile:function(b,c,d){var e=this;this.deviceReady(function(){window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(f){a.log("create dir if not exist"+b),f.root.getDirectory(b,{create:!0,exclusive:!1},function(f){a.log("create file if not exist"+c),f.filesystem.root.getFile(b+"/"+c,{create:!0},function(){null!=d&&d(),e.config.logs.debug&&console.log("+333333++++",arguments)},function(){e.config.logs.debug&&console.log("ERR+++333333++",arguments)})},e.errorHandler)},e.errorHandler)})},listRepertory:function(a){var b=this;this.deviceReady(function(){var c=this.config.media.directory;void 0!=a&&(c=a),window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(a){a.root.getDirectory(c,{create:!1,exclusive:!1},function(a){b.config.logs.debug&&console.log(a);var c=a.createReader();c.readEntries(function(a){var b;for(b=0;b<a.length;b++)console.log(a[b].name)},function(){b.config.logs.debug&&console.log("ERR+++++",arguments)})},b.errorHandler)},b.errorHandler)})},loadMedia:function(a,b){var c,d,e;for(c=0,e=a.length;e>c;c+=1)d=a[c].fullPath,$(b).attr("src",d)},errorHandler:function(b){a.log("erroHanler : Error : ",b)},transfert:function(b,c,d){var e=this;this.deviceReady(function(){if(("undefined"==typeof d||d!==!0)&&1==e.config.media.useSynchro){if("undefined"!=typeof d&&1==d)return;var f={type:b.type,nativeURL:b.nativeURL,name:b.name,infos:c};return e.config.logs.debug&&console.log("on stoke en local",f),void e.storageSetAddToList(e.config.media.synchroName,f)}if(e.config.logs.debug&&console.log("veirf si cnsx ok"),e.minDebitToTransfert()||1!=e.config.media.useSynchro){e.config.logs.debug&&(console.log("debut transfert"),console.log(b));var g=new FileTransfer;"undefined"!=typeof c&&null!==c?c.fileName=b.name:c={fileName:b.name},e.messageInProgress="Tranfert du fichier : "+c.fileName;var h=e.config.media.url_upload(c);e.config.logs.debug&&console.log(h),e.config.loader.uploading=!0,g.upload(b.nativeURL,h,function(b){a.log("Upload success : "+c.fileName+"  -- "+b.responseCode),a.log(b.bytesSent+" bytes sent"),e.messageInProgress="Tranfert du fichier : "+c.fileName+" : OK : "+b.bytesSent+" octets envoyés",e.config.logs.debug&&console.log("Supp ?????????????",d,e.config.media.useSynchro),"undefined"!=typeof d&&1==d&&(e.config.logs.debug&&console.log("Supp !!!!!!!!!!!!!!!"),e.storageSetDelToList(e.config.media.synchroName,c.fileName)),e.config.loader.uploading=!1},function(d){a.log(d),a.log("Error uploading file "+b.nativeURL+": "+d.code),e.messageInProgress="Tranfert du fichier : "+c.fileName+" : ERREUR",a.notif_error({tile:"Transfert de media",message:"Erreur du transfert, tentative ultérieure."}),e.config.loader.uploading=!1},c)}})},downloadMediaURL:function(a,b,c){var d=this;if(null!=a||null!=b||null!=c){var e=navigator.connection.type;e!=Connection.NONE&&d.download(a,b,c)}},download:function(a,b,c){function d(d){var g=encodeURI(a),i=(g.substr(g.lastIndexOf(".")+1),d.root);i.getDirectory(b,{create:!0,exclusive:!1},e,f);var j=d.root,k=j.nativeURL;h.nativeUrl=k,k=k+"/"+b+"/"+c;var l=b+"/"+c;d.root.getFile(l,{create:!1,exclusive:!1},function(a){h.config.logs.debug&&console.log("FileExist",a)},function(a){h.config.logs.debug&&console.log("FileExist",a),h.filetransfer(g,k)})}function e(a){}function f(a){h.config.logs.debug&&console.log("Unable to create new directory: ",a)}function g(a){h.config.logs.debug&&console.log(a)}var h=this;window.requestFileSystem(LocalFileSystem.PERSISTENT,0,d,g)},filetransfer:function(b,c){var d=this;a.log("Download file : "+b);var e=new FileTransfer;d.config.loader.downloading=!0,e.download(b,c,function(a){d.config.logs.debug&&console.log("download complete: ",a),d.config.loader.downloading=!1},function(a){d.config.logs.debug&&console.log("download error source ",a),d.config.loader.downloading=!1})},setNativeURL:function(){var a=this;this.deviceReady(function(){function b(b){var c=b.root;a.config.logs.debug&&console.log("NATIAVE_URL",c.nativeURL),a.nativeURL=c.nativeURL}function c(b){a.config.logs.debug&&console.log(b)}window.requestFileSystem(LocalFileSystem.PERSISTENT,0,b,c)})}};return d}]),angular.module("baPushModule",["baLogs","phonegapModule"]).factory("baPush",["baLogs","$q","$http","baPhoneGap",function(a,b,c,d){var e={listePush:[],config:null,pushNotification:null,genLog:!1,registerSuffix:!0,unRegisterSuffix:!0,senderID:"",token:"",setConfig:function(b){this.config=b,"undefined"!=typeof window.plugins.pushNotification?this.pushNotification=window.plugins.pushNotification:a.error("window.plugins.pushNotification ==> undefined")},getAllNotifications:function(a){return this.listePush},addNotification:function(a){this.listePush.push(a)},is_android:function(){return d.isAndroid()},is_ios:function(){return d.isIOS()},setPushToken:function(a){this.genLog&&this.log("Store token","DEBUG"),localStorage.setItem("pushToken",a)},getPushToken:function(){var a=localStorage.getItem("pushToken");return"undefined"==typeof a||""==a?null:a},registerDeviceAndroid:function(){var a=this.config.push.android.cbSuccessHandler,b=this.config.push.android.cbErrorHandler,c=this.config.push.android.stringcbNotification;"function"!=typeof a&&console.log("callBackSuccessHandler pas une fonction "),"function"!=typeof b&&console.log("callBackErrorHandler pas une fonction "),"string"!=typeof c&&console.log("stringCallBackNotification pas correct "),this.genLog&&this.log("Plugin Register Android, senderID : "+this.senderID+" appel function : "+c,"DEBUG"),this.pushNotification.register(a,b,{senderID:this.senderID,ecb:c})},registerDeviceIos:function(){var a=this.config.push.ios.cbSuccessHandler,b=this.config.push.ios.cbErrorHandler,c=this.config.push.ios.stringcbNotification;"function"!=typeof a&&console.log("callBackSuccessHandler pas une fonction "),"function"!=typeof b&&console.log("callBackErrorHandler pas une fonction "),"string"!=typeof c&&console.log("stringCallBackNotification pas correct "),this.genLog&&this.log("Plugin Register IOS","DEBUG"),this.pushNotification.register(a,b,{badge:"true",sound:"true",alert:"true",ecb:c})},registerDevice:function(){this.is_android()?(this.genLog&&this.log("Register Android ","DEBUG"),this.registerDeviceAndroid(),this.genLog&&this.log("FIN Register Android","DEBUG")):this.is_ios()?(this.genLog&&this.log("Register IOS","DEBUG"),this.registerDeviceIos()):a.notif_error("Device non connu.")},unRegisterDevice:function(a,b){if(this.is_android()){var a=this.config.push.android.cbSuccessHandler,b=this.config.push.android.cbSuccessHandler;this.genLog&&this.log("Unregister Android","DEBUG"),this.pushNotification.unregister(a,b)}else if(this.is_ios()){var a=this.config.push.ios.cbSuccessHandler,b=this.config.push.ios.cbSuccessHandler;this.genLog&&this.log("Unregister IOS","DEBUG"),this.pushNotification.unregister(a,b)}},log:function(a,b){if(this.genLog)if("undefined"==typeof b&&(b="DEBUG"),"string"==typeof a)console.log(b+" : "+a),$(this.divLog).append("<li>"+b+" : "+a+"</li>");else{var c=Math.ceil(100*Math.random()),d=(new Date).getTime();$(this.divLog).append("<li>"+b+" : OBJET("+d+c+") : Voir console</li>"),console.log(b+"("+d+c+")"),console.log(a)}}};return e}]),angular.module("appliMobileBatiActuApp",["ngRoute","ngSanitize","ui.bootstrap","ngTouch","fancyboxplus","synchro","baLogs","baTraduction","baConfig","baPushModule"]).value("configSite",{version:"0.0.1",synchro:{enabled:!0,links:[],storageEnable:!0,storageType:"W",noSyncList:["user"]},profile:{authentificated:!0},analytics:{tag:""},push:{senderId:"366716046205",android:{cbSuccessHandler:null,callBackErrorHandler:null,stringcbNotification:null},ios:{cbSuccessHandler:null,callBackErrorHandler:null,stringcbNotification:null}},protocoleWeb:"https://",msgError:!1,Url:{reseauCnx:"",emploi:"",wsSolr:"http://dev.preprod.batiactu.info/solarium3/scripts/ws.php",pub:"http://capinfoproreport.batiactu.com/cap_pub/scripts/get-pub-support-emplacement.php?e=DROITE1&JSON"},traduction:{lang:"FR",UrlTrad:"scripts/config/trad.json",protocoleWeb:""},extConfig:{Url:"scripts/config/config.json",protocoleWeb:""},logs:{debug:!0,viewLogs:!1,debugUpload:!1,debugUrl:""},loader:{loading:!1,uploading:!1,downloading:!1,interpage:!1}}).run(["$rootScope","configSite","baTraduction","synchro","baLogs","baConfig","baPhoneGap",function(a,b,c,d,e,f,g){a.$on("$viewContentLoaded",function(){jQuery("html, body").animate({scrollTop:0},0)}),a.changeTemplate=function(a,b){return b.replace("entity_type",a)},a.filter={sort:"date",sort_order:"DESC",switch_label:"Date"},a.infoPush={token:"vide"},a.menuToggle={},a.pref_user={themes:{},rubriques:{},types_realisation:{},fabricants:{}},a.realisations_preferees={},a.config=b,e.setConfig(b),g.setConfig(b),d.setConfig(b),c.setConfig(b),f.setConfig(b),f.getConfig().then(function(b){a.config.extConfig.data=b,console.log("Config LOCALE ",a.config.extConfig)}),c.majTrad(function(a){return"undefined"!=typeof a?(d.storageSet("trads",a,!1),null):d.storageGet("trads")})}]).config(["$routeProvider","$httpProvider",function(a,b){var c=!1,d=!1;b.interceptors.push(["$q",function(a){return{request:function(a){return(d||-1!==(pos=a.url.indexOf("php?"))||-1!==(pos=a.url.indexOf(".html"))&&1==c)&&console.log(a),a},response:function(a){var b=0,e=" ----> ";if(d||-1!==(b=a.config.url.indexOf("php?"))||-1!==(b=a.config.url.indexOf(".html"))&&1==c){var f=a.config.url.substr(b);e=" ----> "+f,console.log(e,a)}return a}}}]);var e={data:function(a){return a.getConfig()}};a.when("/identification",{templateUrl:"views/identification.html",controller:"IdentificationCtrl",resolve:e}).when("/connexion",{templateUrl:"views/connexion.html",controller:"LoginCtrl",resolve:e}).when("/inscription",{templateUrl:"views/inscription.html",controller:"LoginCtrl",resolve:e}).when("/motdepasseoublie",{templateUrl:"views/motdepasseoublie.html",controller:"MotdepasseoublieCtrl",resolve:e}).when("/home",{templateUrl:"views/home.html",controller:"ArticlesCtrl",resolve:e}).when("/photos",{templateUrl:"views/photos.html",controller:"ArticlesCtrl",resolve:e}).when("/actualites",{templateUrl:"views/home.html",controller:"ArticlesCtrl",resolve:e}).when("/produits",{templateUrl:"views/home.html",controller:"ArticlesCtrl",resolve:e}).when("/realisations",{templateUrl:"views/home.html",controller:"ArticlesCtrl",resolve:e}).when("/formations",{templateUrl:"views/home.html",controller:"ArticlesCtrl",resolve:e}).when("/materiels",{templateUrl:"views/home.html",controller:"ArticlesCtrl",resolve:e}).when("/articles/:id",{templateUrl:"views/article.html",controller:"ArticleDetailsCtrl",resolve:e}).when("/articles/:id/:page",{templateUrl:"views/article.html",controller:"ArticleDetailsCtrl",resolve:e}).when("/articles/formation/demande-doc/:id",{templateUrl:"views/demande_doc.html",controller:"ArticleDetailsCtrl",resolve:e}).when("/profil",{templateUrl:"views/profil.html",controller:"ProfilCtrl",resolve:e}).when("/compte",{templateUrl:"views/compte.html",controller:"CompteCtrl",resolve:e}).when("/filactu",{templateUrl:"views/filactu.html",controller:"FilActuCtrl",resolve:e}).when("/gestionFilActu",{templateUrl:"views/gestionFilActu.html",controller:"GestionFilActuCtrl",resolve:e}).when("/discussions",{templateUrl:"views/discussions.html",controller:"DiscussionsCtrl",resolve:e}).when("/new_discussion",{templateUrl:"views/new_discussion.html",controller:"DiscussionsCtrl",resolve:e}).when("/gestion_realisations",{templateUrl:"views/realisations.html",controller:"RealisationsCtrl",resolve:e}).when("/ajout_realisation",{templateUrl:"views/realisations/ajout_realisation.html",controller:"RealisationsCtrl",resolve:e}).when("/mes_realisations",{templateUrl:"views/realisations/mes_realisations.html",controller:"RealisationsCtrl",resolve:e}).when("/realisations_preferees",{templateUrl:"views/realisations/mes_realisations_preferees.html",controller:"RealPrefCtrl",resolve:e}).when("/groupes",{templateUrl:"views/groupes.html",controller:"GroupesCtrl",resolve:e}).when("/enCoursDeveloppement",{templateUrl:"views/enCoursDeveloppement.html"}).when("/parametres_appli",{templateUrl:"views/parametres_appli.html"}).when("/conditions",{templateUrl:"views/conditions.html"}).when("/propos",{templateUrl:"views/propos.html"}).when("/contact",{templateUrl:"views/contact.html"}).otherwise({redirectTo:"/home"})}]),angular.module("appliMobileBatiActuApp").factory("ArticleFactory",["$http","$rootScope","$q","configSite",function(a,b,c,d){var e={URL:"",articles:!1,filterOld:"",article:[],themes:!1,entity_types:!1,rubriques:!1,typesRealisation:!1,typesTravaux:!1,fabricants:!1,categories:!1,nbArtMax:36,nbPub:8,entity_default:"article_edito OR produitheque_produit OR reseau_realisation OR formation_annonce OR materiel_annonce",emplacementPub:function(a){if(a>0){var b=e.nbArtMax/e.nbPub,c=a%Math.floor(b);return 0==c}return!1},getArticles:function(f){b.config.loader=!0;var g=c.defer();if("undefined"!=typeof f&&angular.toJson(f)!=e.filterOld&&(e.filterOld=angular.toJson(f),e.articles=!1),e.articles!==!1)g.resolve(e.articles),b.config.loader=!1;else{var h=d.Url.wsSolr+"?nb_item="+e.nbArtMax;if(console.log("FILTER :",f),"undefined"!=typeof f){var i="date";"undefined"!=typeof f.keywords&&(h=h+"&KEYWORDS="+f.keywords),void 0!==f.sort&&(i=f.sort),h=h+"&SORT_ORDER="+i+"|"+(f.sort_order?f.sort_order:"DESC"),"undefined"!=typeof f.theme&&(h=h+"&themeFILTER="+encodeURIComponent(f.theme)),h="undefined"!=typeof f.entity_type?h+"&ENTITY="+f.entity_type:h+"&ENTITY="+e.entity_default,"undefined"!=typeof f.rubrique&&(h=h+"&rubriqueFILTER="+f.rubrique),"undefined"!=typeof f.type_realisation&&(h=h+"&type_realFILTER="+f.type_realisation),"undefined"!=typeof f.type_travaux&&(h=h+"&type_travFILTER="+f.type_travaux),"undefined"!=typeof f.fabricant&&(h=h+"&fabricantFILTER="+f.fabricant),"undefined"!=typeof f.page&&(h=h+"&N="+f.page),"undefined"!=typeof f.manual&&(h=h+"&manualFILTER="+f.manual)}else h=h+"&ENTITY="+e.entity_default;e.URL=h,console.log(h),a.get(h).then(function(a,b){e.articles=a.data,"undefined"!=typeof a.data&&"undefined"!=typeof a.data.facets&&("undefined"!=typeof a.data.facets.entity_type&&(e.entity_types=[],angular.forEach(a.data.facets.entity_type,function(a){e.entity_types.push(a)})),"undefined"!=typeof a.data.facets.theme&&(e.themes=a.data.facets.theme),"undefined"!=typeof a.data.facets.rubrique&&(e.rubriques=a.data.facets.rubrique),"undefined"!=typeof a.data.facets.type_realisation&&(e.typesRealisation=a.data.facets.type_realisation),"undefined"!=typeof a.data.facets.type_travaux&&(e.typesTravaux=a.data.facets.type_travaux),"undefined"!=typeof a.data.facets.fabricant&&(e.fabricants=a.data.facets.fabricant),"undefined"!=typeof a.data.facets.categorie&&(e.categorie=a.data.facets.categorie)),""==e.articles?(e.articles="Désolé, votre recherche n'a pas abouti.",g.reject("Désolé, votre recherche n'a pas abouti.")):g.resolve(e.articles)},function(a,b){g.reject("Impossible de récupérer les articles")})["finally"](function(){b.config.loader=!1})}return g.promise},getArticle:function(b){var f=c.defer();return void 0!==e.article[b]?f.resolve(e.article[b]):a.get(d.Url.wsSolr+"?ID="+b).success(function(a,c){e.article[b]=a.items,f.resolve(e.article[b])}).error(function(a,b){f.reject("Impossible de récupérer l'article")}),f.promise},getEntityTypes:function(){var a=c.defer();return setTimeout(function(){a.resolve(e.entity_types)},1e3),a.promise},getThemes:function(){var a=c.defer();return setTimeout(function(){a.resolve(e.themes)},1e3),a.promise},getRubriques:function(){var a=c.defer();return setTimeout(function(){a.resolve(e.rubriques)},1e3),a.promise},getTypesRealisation:function(){var a=c.defer();return setTimeout(function(){a.resolve(e.typesRealisation)},1e3),a.promise},getTypesTravaux:function(){var a=c.defer();return setTimeout(function(){a.resolve(e.typesTravaux)},1e3),a.promise},getFabricants:function(){var a=c.defer();return setTimeout(function(){a.resolve(e.fabricants)},1e3),a.promise},getCategories:function(){var a=c.defer();return setTimeout(function(){a.resolve(e.categories)},1e3),a.promise}};return e}]),angular.module("appliMobileBatiActuApp").factory("ConfigFactory",["$http","$q",function(a,b){var c={res:{}};return c}]),angular.module("appliMobileBatiActuApp").factory("PubFactory",["$http","$q","configSite",function(a,b,c){var d={pubs:!1,getPubs:function(){var e=b.defer();return d.pubs!==!1?d.pubs:(a.get(c.Url.pub).success(function(a,b){var c=[];angular.forEach(a,function(a,b){-1==a.fichier.indexOf("swf")&&""!=a.fichier&&(0==c&&(c=[]),c.push(a))}),e.resolve(c)}).error(function(a,b){e.reject("Impossible de récupérer les pubs")}),d.pubs=e.promise,e.promise)},getRandomPub:function(a){var b=Math.floor(Math.random()*a.length)+1;return a[b]}};return d}]),angular.module("appliMobileBatiActuApp").factory("CompteFactory",["$http","$rootScope","$q","configSite",function(a,b,c,d){var e={facets:!1,themes:!1,rubriques:!1,typesRealisation:!1,typesTravaux:!1,fabricants:!1,getAllFacets:function(f){b.config.loader=!0;var g=c.defer();if(e.facets!==!1)g.resolve(e.facets),b.config.loader=!1;else{var h=d.Url.wsSolr;a.get(h).success(function(a,c){e.facets=a.facets,""==e.facets&&(e.facets="Désolé, votre recherche n'a pas abouti."),g.resolve(e.facets),b.config.loader=!1}).error(function(a,b){g.reject("Impossible de récupérer les facets")})}return g.promise},getThemes:function(){var a=c.defer();return setTimeout(function(){a.resolve(e.facets.theme);
},1e3),a.promise},getRubriques:function(){var a=c.defer();return setTimeout(function(){a.resolve(e.facets.rubrique)},1e3),a.promise},getTypesRealisation:function(){var a=c.defer();return setTimeout(function(){a.resolve(e.facets.types_realisation)},1e3),a.promise},getTypesTravaux:function(){var a=c.defer();return setTimeout(function(){a.resolve(e.facets.types_travaux)},1e3),a.promise},getFabricants:function(){var a=c.defer();return setTimeout(function(){a.resolve(e.facets.fabricant)},1e3),a.promise}};return e}]),angular.module("appliMobileBatiActuApp").factory("GroupeFactory",["$http","$rootScope","$q","configSite",function(a,b,c,d){var e={groupes:!1,categories:!1,getGroupes:function(f){b.config.loader=!0;var g=c.defer();if("undefined"!=typeof f&&angular.toJson(f)!=e.filterOld&&(e.filterOld=angular.toJson(f),e.groupes=!1),e.groupes!==!1)g.resolve(e.groupes),b.config.loader=!1;else{var h=d.Url.wsSolr+"?ENTITY=reseau_groupe";if("undefined"!=typeof f){var i="";i=1==f.sort_order_date_or_relevance?"date":"score","undefined"!=typeof f.keywords?h=h+"&KEYWORDS="+f.keywords:i="date",h=h+"&SORT_ORDER="+i+"|DESC","undefined"!=typeof f.categorie&&(h=h+"&categorieFILTER="+encodeURIComponent(f.categorie)),"undefined"!=typeof f.page&&(h=h+"&N="+f.page)}a.get(h).success(function(a,c){e.groupes=a,"undefined"!=typeof a&&"undefined"!=typeof a.facets&&"undefined"!=typeof a.facets.categorie&&(e.categories=a.facets.categorie),""==e.groupes&&(e.groupes="Désolé, votre recherche n'a pas abouti."),g.resolve(e.groupes),b.config.loader=!1}).error(function(a,b){g.reject("Impossible de récupérer les groupes")})}return g.promise},getCategories:function(){var a=c.defer();return setTimeout(function(){a.resolve(e.categories)},1e3),a.promise}};return e}]),angular.module("appliMobileBatiActuApp").factory("RealisationFactory",["$http","$rootScope","$q","configSite",function(a,b,c,d){var e={URL:"",articles:!1,article:[],entity_types:!1,typesRealisation:!1,typesTravaux:!1,getArticles:function(f){b.config.loader=!0;var g=c.defer();if("undefined"!=typeof f&&angular.toJson(f)!=e.filterOld&&(e.filterOld=angular.toJson(f),e.articles=!1),e.articles!==!1)g.resolve(e.articles),b.config.loader=!1;else{var h=d.Url.wsSolr+"?nb_item=36&ENTITY=reseau_realisation";"undefined"!=typeof f&&("undefined"!=typeof f.type_realisation&&(h=h+"&type_realFILTER="+f.type_realisation),"undefined"!=typeof f.type_travaux&&(h=h+"&type_travFILTER="+f.type_travaux),"undefined"!=typeof f.page&&(h=h+"&N="+f.page),"undefined"!=typeof f.manual&&(h=h+"&manualFILTER="+f.manual)),a.get(h).success(function(a,c){e.articles=a,"undefined"!=typeof a&&"undefined"!=typeof a.facets&&("undefined"!=typeof a.facets.type_realisation&&(e.typesRealisation=a.facets.type_realisation),"undefined"!=typeof a.facets.type_travaux&&(e.typesTravaux=a.facets.type_travaux)),""==e.articles&&(e.articles="Désolé, votre recherche n'a pas abouti."),g.resolve(e.articles),b.config.loader=!1}).error(function(a,b){g.reject("Impossible de récupérer les articles")})}return g.promise},getArticle:function(b){var f=c.defer();return void 0!==e.article[b]?f.resolve(e.article[b]):a.get(d.Url.wsSolr+"?ID="+b).success(function(a,c){e.article[b]=a.items,f.resolve(e.article[b])}).error(function(a,b){f.reject("Impossible de récupérer l'article")}),f.promise},getTypesRealisation:function(){var a=c.defer();return setTimeout(function(){a.resolve(e.typesRealisation)},1e3),a.promise},getTypesTravaux:function(){var a=c.defer();return setTimeout(function(){a.resolve(e.typesTravaux)},1e3),a.promise}};return e}]),angular.module("appliMobileBatiActuApp").filter("range",function(){return function(a,b){b=parseInt(b);for(var c=1;b>=c;c++)a.push(c);return a}}).filter("replaceCharacter",function(){return function(a){return void 0!=a?a.replace(/\r\n/g,"<br>").replace(/\t/g,"&nbsp&nbsp&nbsp&nbsp").replace("[PUB]"," ").replace("[NOPUB]"," "):""}}).filter("traduction",["$rootScope",function(a){return function(b,c){return("DESC"==b||"ASC"==b)&&(b=c+"_"+b),"0"==b&&(b="1"),"undefined"==typeof b||"undefined"==typeof a.config.trad||"undefined"==typeof a.config.trad[b]?b:a.config.trad[b]}}]).filter("dedoublonne",function(){return function(a){if(void 0==a)return[];for(var b=[],c=[],d=0;d<a.length;d++)void 0==b[a[d]]&&(b[a[d]]=a[d],c.push(a[d]));return c}}).filter("toEuros",function(){return function(a){return void 0==a||""==a||0==a?"":Number(a).toLocaleString("fr-FR",{minimumFractionDigits:0})+" €"}}),angular.module("appliMobileBatiActuApp").directive("errSrc",function(){return{link:function(a,b,c){b.bind("error",function(){c.src!=c.errSrc&&c.$set("src",c.errSrc)})}}}),angular.module("appliMobileBatiActuApp").controller("ArticleDetailsCtrl",["$scope","ArticleFactory","$log","$routeParams","$route","$filter","$location","configSite",function(a,b,c,d,e,f,g,h){a.article=!1,a.rubriques=!1,a.fabricants=!1,a.typesRealisation=!1,a.page=void 0==d.page?1:d.page,a.$routeParams=d,a.$location=g,a.$log=c,a.unArticle={},a.realisations_preferees=JSON.parse(localStorage.getItem("realisations_preferees")),$("#favoriInfoAdd").hide(),$("#favoriInfoDelete").hide(),b.getArticle(d.id).then(function(b){a.article=b[0],a.unArticle=a.fromJJson(a.article.zs_json)}),a.retourRecherche=function(a){void 0!=a?g.path(h.extConfig.data.configEntityType[a].path):g.path("/")},a.fromJJson=function(a){return angular.fromJson(a)},a.imgResize=function(a){var b=a.replace("medium","medium_auto/300-200-c");return b},a.imgResizeToBig=function(a){var b=a.replace("medium","big");return b},a.upperCaseFirstChar=function(a){return stringUpper=a.charAt(0).toUpperCase()+a.slice(1),stringUpper},a.comptePage=function(a){return null==a||void 0==a?"":a.length+1},a.int_val=function(a){return parseInt(a)},a.lienPhoto=function(a,b){var c;for(c=0;c<a.length;c++)if(parseInt(a[c].page)==b){var d=(a[c].photo.fichier1,a[c].taille);return{fichier:a[c].photo.fichier1,taille:d}}return{}},a.precSuiv=function(){var a,c=-1,e="",f="",g="",h="",i="",j="";if(b.articles){if(void 0==b.articles.items)return{};for(a=0;a<b.articles.items.length;a++)b.articles.items[a].id==d.id&&(c=a);return 0==c?void 0!=b.articles.items&&void 0!=b.articles.items[c+1]&&(h=b.articles.items[c+1].id,i=b.articles.items[c+1].label,j=void 0!=b.articles.items[c+1].sm_image_url&&void 0!=b.articles.items[c+1].sm_image_url[0]?b.articles.items[c+1].sm_image_url[0]:null):c==b.articles.items.length-1?void 0!=b.articles.items&&void 0!=b.articles.items[c-1]&&(e=b.articles.items[c-1].id,f=b.articles.items[c-1].label,g=void 0!=b.articles.items[c-1].sm_image_url&&void 0!=b.articles.items[c-1].sm_image_url[0]?b.articles.items[c-1].sm_image_url[0]:null):(void 0!=b.articles.items&&void 0!=b.articles.items[c-1]&&(e=b.articles.items[c-1].id,f=b.articles.items[c-1].label,g=void 0!=b.articles.items[c-1].sm_image_url&&void 0!=b.articles.items[c-1].sm_image_url[0]?b.articles.items[c-1].sm_image_url[0]:null),void 0!=b.articles.items&&void 0!=b.articles.items[c+1]&&(h=b.articles.items[c+1].id,i=b.articles.items[c+1].label,j=void 0!=b.articles.items[c+1].sm_image_url&&void 0!=b.articles.items[c+1].sm_image_url[0]?b.articles.items[c+1].sm_image_url[0]:null)),{idPrec:e,labelPrec:f,imgPrec:g,idSuiv:h,labelSuiv:i,imgSuiv:j}}return{}},a.pagePrecedente=function(b,c){a.int_val(a.page)>1&&g.path("/articles/"+d.id+"/"+(a.int_val(a.page)-1))},a.pageSuivante=function(b,c){a.int_val(a.page)<a.comptePage(c.TPage)&&g.path("/articles/"+d.id+"/"+(a.int_val(a.page)+1))},a.repeteFakeArticles=function(a){return new Array(a)},a.ajoutRealisationPreferee=function(b){null==a.realisations_preferees&&(a.realisations_preferees={}),"undefined"==typeof a.realisations_preferees[b.entity_id]?(a.realisations_preferees[b.entity_id]=b,$("#ajout-real-favoris").text("Retirer cette réalisation des favoris"),$("#favoriInfoAdd").fadeIn(),setTimeout(function(){$("#favoriInfoAdd").fadeOut()},1500)):(delete a.realisations_preferees[b.entity_id],$("#ajout-real-favoris").text("Ajouter cette réalisation aux favoris"),$("#favoriInfoDelete").fadeIn(),setTimeout(function(){$("#favoriInfoDelete").fadeOut()},1500)),localStorage.setItem("realisations_preferees",JSON.stringify(a.realisations_preferees))}}]),angular.module("appliMobileBatiActuApp").controller("ArticlesCtrl",["$scope","$log","$location","$route","ArticleFactory","$filter","$anchorScroll","configSite",function(a,b,c,d,e,f,g,h){a.articles=!1,a.themes=!1,a.entity_types=!1,a.rubriques=!1,a.types_realisation=!1,a.types_travaux=!1,a.fabricants=!1,a.nb_page=0,a.nb_page=0,a.ws=!1,a.factory=e,a.$location=c,a.$log=b,a.Math=window.Math;var i=JSON.parse(localStorage.getItem("user"));(null==i||void 0==i.isConnected||1!=i.isConnected)&&c.path("/identification");var j=function(){e.getArticles(a.filter).then(function(b){a.articles=b.items,a.facets=b.facets,a.ws=b})};a.titreHome="Liste des articles / annonces",a.sousTitreHome="Découvrez ici toutes les informations de Batiactu Groupe.",angular.forEach(h.extConfig.data.configEntityType,function(b,d){c.path()==b.path&&(angular.forEach(a.filter,function(b,c){delete a.filter[c]}),a.filter.entity_type=d,a.filter.sort_order=b.sort_order,a.filter.sort=b.sort,a.filter.manual=b.manualFilter,a.filter.switch_label=b.switch_label,a.titreHome=b.titreHome,a.sousTitreHome=b.sousTitreHome)}),a.int_val=parseInt,j(),a.search=function(){""==a.filter.keywords&&delete a.filter.keywords,console.log("SEARCH --->  ",a.filter),j(),c.hash("top"),g()},a.showFilter=function(a){return 1},a.filterPage=function(b){a.filter.page=b,j(),c.hash("top"),g()},a.status={isFirstOpen:!0,isFirstDisabled:!1},a.sortByTheme=function(b){angular.forEach(a.filter,function(b,c){delete a.filter[c]}),a.filter.theme=b,a.filter.entity_type="article_edito",j(),g()},a.sortByEntityType=function(b){a.filter.entity_type=b,$("#sidebar-wrapper").removeClass("active"),j(),c.hash("top"),g()},a.sortByRubrique=function(b){angular.forEach(a.filter,function(b,c){delete a.filter[c]}),a.filter.entity_type="article_edito",a.filter.rubrique=b,$("#sidebar-wrapper").removeClass("active"),j(),c.hash("top"),g()},a.sortByTypeRealisation=function(b){angular.forEach(a.filter,function(b,c){delete a.filter[c]}),a.filter.type_realisation=b,a.filter.entity_type="reseau_realisation",$("#sidebar-wrapper").removeClass("active"),j(),c.hash("top"),g()},a.sortByTypeTravaux=function(b){angular.forEach(a.filter,function(b,c){delete a.filter[c]}),a.filter.type_travaux=b,a.filter.entity_type="reseau_realisation",$("#sidebar-wrapper").removeClass("active"),j(),c.hash("top"),g()},a.sortByFabricants=function(b){angular.forEach(a.filter,function(b,c){delete a.filter[c]}),a.filter.fabricant=b,a.filter.entity_type="produitheque_produit",$("#sidebar-wrapper").removeClass("active"),j()},a.sortByCategories=function(b){angular.forEach(a.filter,function(b,c){delete a.filter[c]}),a.filter.categorie=b,j(),c.hash("top"),g()},a.removeFilter=function(b,c){delete a.filter[b],j(),e.getEntityTypes().then(function(b){a.menuToggle.entity_types=b})},a.removeAllFilters=function(b){angular.forEach(b,function(b,c){delete a.filter[c]}),j(),c.path("/home"),d.reload(),e.getEntityTypes().then(function(b){a.menuToggle.entity_types=b}),a.filter.sort="date",a.filter.sort_order="DESC"},a.repeteFakeArticles=function(a){return new Array(a)},a.fixText=function(a,b){return a.substr(0,b)+"..."},a.deconnexion=function(){localStorage.removeItem("user"),h.profile.authentificated=!1,c.path("/identification")},a.URL=e.URL+"&DEBUG=1"}]),angular.module("appliMobileBatiActuApp").controller("PubCtrl",["$scope","$log","PubFactory",function(a,b,c){a.pubs=!1,a.pubFactory=c,a.$log=b,c.getPubs().then(function(b){a.pubs=b,a.pub=c.getRandomPub(a.pubs)})}]),angular.module("appliMobileBatiActuApp").controller("IdentificationCtrl",["$scope","$location","configSite",function(a,b,c){var d=a.slides=[];d.push({icon:"fa-newspaper-o",image:"images/image1.jpg",text:"Des milliers d'articles n'attendent que vous",title:"Découvrez les actualités et produits de Batiactu"}),d.push({icon:"fa-user-plus",image:"images/image3.jpg",text:"Connectez-vous et rencontrez des membres et leurs réalisations",title:"Créez votre réseau"}),d.push({icon:"fa-briefcase",image:"images/image7.jpg",text:"Consultez, recherchez et sauvegardez les articles, produits et réalisations de Batiactu",title:"Trouvez vos futurs travaux ou laissez-les vous trouver"}),d.push({icon:"fa-comments-o",image:"images/image4.jpg",text:"Commentez les articles ou réalisations et participez aux disscussions de Batiactu",title:"Rendez-vous acteur de la communauté"}),d.push({icon:"fa-file-text-o",image:"images/image5.jpg",text:"Ouvrez la porte aux opportunités",title:"Créez votre profil"})}]),angular.module("appliMobileBatiActuApp").controller("CompteCtrl",["$scope","$log","$location","$route","CompteFactory","$filter","$anchorScroll",function(a,b,c,d,e,f,g){a.factory=e,a.$location=c,a.$log=b,e.getAllFacets().then(function(b){a.facets=b}),a.triAlphabetique=function(a,b){return a.name<b.name?-1:a.name==b.name?0:1},a.triFavoris=function(b){if(void 0==b||0==b)return"";var c=b.sort(a.triAlphabetique);return c}}]),angular.module("appliMobileBatiActuApp").controller("FilActuCtrl",["$scope","$log","$location","$route","ArticleFactory","$filter","$anchorScroll",function(a,b,c,d,e,f,g){a.articles=!1,a.themes=!1,a.entity_types=!1,a.rubriques=!1,a.types_realisation=!1,a.types_travaux=!1,a.fabricants=!1,a.nb_page=0,a.ws=!1,a.factory=e,a.$location=c,a.$log=b,a.Math=window.Math,a.filter2={};var h=JSON.parse(localStorage.getItem("preferences_user_theme")),i=JSON.parse(localStorage.getItem("preferences_user_rubrique")),j=JSON.parse(localStorage.getItem("preferences_user_type_real")),k=JSON.parse(localStorage.getItem("preferences_user_fabricant"));null==h&&(h={}),null==i&&(i={}),null==j&&(j={}),null==k&&(k={}),a.pref_user.themes=h,a.pref_user.rubriques=i,a.pref_user.types_realisation=j,a.pref_user.fabricants=k,a.int_val=function(a){return parseInt(a)};var l=!0;angular.forEach(h,function(b){l?a.filter2.manual="sm_theme:"+b.theme:a.filter2.manual+=" OR sm_theme:"+b.theme,l=!1}),angular.forEach(i,function(b){l?a.filter2.manual="sm_rubrique:"+b.rubrique:a.filter2.manual+=" OR sm_rubrique:"+b.rubrique,l=!1}),angular.forEach(j,function(b){l?a.filter2.manual="ss_type_real:"+b.type_real:a.filter2.manual+=" OR ss_type_real:"+b.type_real,l=!1}),angular.forEach(k,function(b){l?a.filter2.manual="ss_indus:"+b.fabricant:a.filter2.manual+=" OR ss_indus:"+b.fabricant,l=!1}),e.getArticles(a.filter2).then(function(b){a.articles=b.items,a.facets=b.facets,a.ws=b}),a.search=function(b){""==a.filter2.keywords&&delete a.filter2.keywords,e.getArticles(b).then(function(b){a.articles=b.items,a.ws=b})},a.switchDateAndRelevance=function(){a.filter2.switch_label=1==a.filter2.sort_order_date_or_relevance?"Pertinence":"Date",e.getArticles(a.filter2).then(function(b){a.articles=b.items,a.ws=b})},a.filterPage=function(b){a.filter2.page=b,e.getArticles(a.filter2).then(function(b){a.articles=b.items,a.ws=b}),c.hash("top"),g()},a.repeteFakeArticles=function(a){return new Array(a)}}]),angular.module("appliMobileBatiActuApp").controller("GroupesCtrl",["$scope","$log","$location","$route","GroupeFactory","$filter","$anchorScroll","$routeParams",function(a,b,c,d,e,f,g,h){a.groupe=!1,a.groupes=!1,a.categories=!1,a.nb_page=0,a.ws=!1,a.factory=e,a.$location=c,a.$log=b,a.Math=window.Math,a.int_val=function(a){return parseInt(a)},e.getGroupes(a.filter).then(function(b){a.groupes=b.items,a.categories=b.facets.categorie,a.ws=b}),e.getGroupes(h.id).then(function(b){a.groupe=b[0]}),a.search=function(b){""==a.filter.keywords&&delete a.filter.keywords,e.getGroupes(b).then(function(b){a.groupes=b.items,a.ws=b})},a.switchDateAndRelevance=function(){a.filter.switch_label=1==a.filter.sort_order_date_or_relevance?"Pertinence":"Date",e.getGroupes(a.filter).then(function(b){a.groupes=b.items,a.ws=b})},a.filterPage=function(b){a.filter.page=b,e.getGroupes(a.filter).then(function(b){a.groupes=b.items,a.ws=b}),c.hash("top"),g()},a.sortByCategories=function(b){angular.forEach(a.filter,function(b,c){delete a.filter[c]}),a.filter.categorie=b,e.getGroupes(a.filter).then(function(b){a.groupes=b.items,a.ws=b}),c.hash("top"),g()},e.getCategories().then(function(b){a.categories=b}),a.fixText=function(a,b){return a.substr(0,b)+"..."},a.getInitials=function(a){var b=[];for(i=0;i<a.split(" ").length;i++)b.push(a.split(" ")[i].substr(0,1).toUpperCase()+".");return void 0!==b[1]&&void 0==b[2]?b[0]+b[1]:void 0!==b[1]&&void 0!==b[2]?b[0]+b[1]+b[2]:b[0]}}]),angular.module("appliMobileBatiActuApp").controller("RealisationsCtrl",["$scope","$log","$location","$route","RealisationFactory","$filter","$anchorScroll",function(a,b,c,d,e,f,g){a.articles=!1,a.types_realisation=!1,a.types_travaux=!1,a.factory=e,a.$location=c,a.$log=b,a.listeMois=["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"];var h=function(){var a=(new Date).getFullYear(),b=[];for(i=a;i>=2e3;i--)b.push(i);return b};a.listeAnnees=h(),e.getArticles(a.filter).then(function(b){a.articles=b.items,a.facets=b.facets,a.ws=b}),e.getTypesRealisation().then(function(b){a.menuToggle.types_realisation=b}),e.getTypesTravaux().then(function(b){a.menuToggle.types_travaux=b})}]),angular.module("appliMobileBatiActuApp").controller("DiscussionsCtrl",["$scope",function(a){}]),angular.module("appliMobileBatiActuApp").controller("GestionFilActuCtrl",["$scope","$log","$location","$route","CompteFactory","$filter","$anchorScroll",function(a,b,c,d,e,f,g){a.factory=e,a.$location=c,a.$log=b,$("#favoriInfoAdd").hide(),$("#favoriInfoDelete").hide();var h=JSON.parse(localStorage.getItem("preferences_user_theme")),i=JSON.parse(localStorage.getItem("preferences_user_rubrique")),j=JSON.parse(localStorage.getItem("preferences_user_type_real")),k=JSON.parse(localStorage.getItem("preferences_user_fabricant"));null==h&&(h={}),null==i&&(i={}),null==j&&(j={}),null==k&&(k={}),a.pref_user.themes=h,a.pref_user.rubriques=i,a.pref_user.types_realisation=j,a.pref_user.fabricants=k,e.getAllFacets().then(function(b){a.facets=b}),setTimeout(function(){"/gestionFilActu"==c.path()&&angular.forEach(a.pref_user.themes,function(a){angular.element(document.querySelector("#"+a.id)).addClass("text-success"),angular.element(document.querySelector("#span"+a.id)).addClass("fa fa-check")})},1e3),setTimeout(function(){"/gestionFilActu"==c.path()&&angular.forEach(a.pref_user.rubriques,function(a){angular.element(document.querySelector("#"+a.id)).addClass("text-success"),angular.element(document.querySelector("#span"+a.id)).addClass("fa fa-check")})},1e3),setTimeout(function(){"/gestionFilActu"==c.path()&&angular.forEach(a.pref_user.types_realisation,function(a){angular.element(document.querySelector("#"+a.id)).addClass("text-success"),angular.element(document.querySelector("#span"+a.id)).addClass("fa fa-check")})},1e3),setTimeout(function(){"/gestionFilActu"==c.path()&&angular.forEach(a.pref_user.fabricants,function(a){angular.element(document.querySelector("#"+a.id)).addClass("text-success"),angular.element(document.querySelector("#span"+a.id)).addClass("fa fa-check")})},1e3),a.triAlphabetique=function(a,b){return a.name<b.name?-1:a.name==b.name?0:1},a.triFavoris=function(b){if(void 0==b||0==b)return"";var c=b.sort(a.triAlphabetique);return c},a.addThemeToFav=function(b,c){var d="th_"+c;$("#"+d).toggleClass("text-success"),$("#span"+d).toggleClass("fa-check"),"undefined"==typeof a.pref_user.themes[b]?(a.pref_user.themes[b]={theme:b,id:d},$("#favoriInfoAdd span").text("Le thème "+b),$("#favoriInfoAdd").fadeIn(),setTimeout(function(){$("#favoriInfoAdd").fadeOut()},1e3)):(delete a.pref_user.themes[b],$("#favoriInfoDelete span").text("Le thème "+b),$("#favoriInfoDelete").fadeIn(),setTimeout(function(){$("#favoriInfoDelete").fadeOut()},1e3)),localStorage.setItem("preferences_user_theme",JSON.stringify(a.pref_user.themes))},a.addRubriqueToFav=function(b,c){var d="rub_"+c;$("#"+d).toggleClass("text-success"),$("#span"+d).toggleClass("fa-check"),"undefined"==typeof a.pref_user.rubriques[b]?(a.pref_user.rubriques[b]={rubrique:b,id:d},$("#favoriInfoAdd span").text("La rubrique "+b),$("#favoriInfoAdd").fadeIn(),setTimeout(function(){$("#favoriInfoAdd").fadeOut()},1e3)):(delete a.pref_user.rubriques[b],$("#favoriInfoDelete span").text("La rubrique "+b),$("#favoriInfoDelete").fadeIn(),setTimeout(function(){$("#favoriInfoDelete").fadeOut()},1e3)),localStorage.setItem("preferences_user_rubrique",JSON.stringify(a.pref_user.rubriques))},a.addTypeRealToFav=function(b,c){var d="real_"+c;$("#"+d).toggleClass("text-success"),$("#span"+d).toggleClass("fa-check"),"undefined"==typeof a.pref_user.types_realisation[b]?(a.pref_user.types_realisation[b]={type_real:b,id:d},$("#favoriInfoAdd span").text("Le type de réalisation "+b),$("#favoriInfoAdd").fadeIn(),setTimeout(function(){$("#favoriInfoAdd").fadeOut()},1e3)):(delete a.pref_user.types_realisation[b],$("#favoriInfoDelete span").text("Le type de réalisation "+b),$("#favoriInfoDelete").fadeIn(),setTimeout(function(){$("#favoriInfoDelete").fadeOut()},1e3)),localStorage.setItem("preferences_user_type_real",JSON.stringify(a.pref_user.types_realisation))},a.addFabricantToFav=function(b,c){var d="fab_"+c;$("#"+d).toggleClass("text-success"),$("#span"+d).toggleClass("fa-check"),"undefined"==typeof a.pref_user.fabricants[b]?(a.pref_user.fabricants[b]={fabricant:b,id:d},$("#favoriInfoAdd span").text("Le fabricant "+b),$("#favoriInfoAdd").fadeIn(),setTimeout(function(){$("#favoriInfoAdd").fadeOut()},1e3)):(delete a.pref_user.fabricants[b],$("#favoriInfoDelete span").text("Le fabricant "+b),$("#favoriInfoDelete").fadeIn(),setTimeout(function(){$("#favoriInfoDelete").fadeOut()},1e3)),localStorage.setItem("preferences_user_fabricant",JSON.stringify(a.pref_user.fabricants))},a.deletePrefs=function(){localStorage.removeItem("preferences_user_theme"),localStorage.removeItem("preferences_user_rubrique"),localStorage.removeItem("preferences_user_type_real"),localStorage.removeItem("preferences_user_fabricant")}}]),angular.module("appliMobileBatiActuApp").controller("ProfilCtrl",["$scope","$location",function(a,b){}]),angular.module("appliMobileBatiActuApp").controller("GestionCtrl",["$scope","$log","$location","$route","ArticleFactory","$filter","$anchorScroll","configSite","baPush",function(a,b,c,d,e,f,g,h,i){a.videEntity=function(){delete a.filter.entity_type,delete a.filter.rubrique,delete a.filter.theme,delete a.filter.fabricant,delete a.filter.type_realisation,"/home"==c.path()?d.reload():c.path("/home")},a.registerPush=function(){i.registerDevice()},e.getThemes().then(function(b){a.menuToggle.themes=b}),e.getRubriques().then(function(b){a.menuToggle.rubriques=b}),e.getTypesRealisation().then(function(b){a.menuToggle.types_realisation=b}),e.getTypesTravaux().then(function(b){a.menuToggle.types_travaux=b}),e.getFabricants().then(function(b){a.menuToggle.fabricants=b})}]),angular.module("appliMobileBatiActuApp").controller("FiltreCtrl",["$scope","$log","$location","$route","ArticleFactory","$filter","$anchorScroll",function(a,b,c,d,e,f,g){a.toogle=function(){$("#sidebar-wrapper").toggleClass("active")}}]),angular.module("appliMobileBatiActuApp").controller("MaterielCtrl",["$scope","ArticleFactory","$log","$routeParams","$route","$filter","$location","fancyboxService",function(a,b,c,d,e,f,g,h){var i=function(a){var b={marque:{label:"Marque"},modele:{label:"Modèle"},annee:{label:"Annee"},heure:{label:"Heure"},etat:{label:"Etat",convert:{1:"Neuf",2:"Très bon",3:"Bon",4:"Prévoir réparations",5:"Pour pièces détachées"}},fleches:{label:"Flèches",unite:"m"},puissance_ch:{label:"Puissance ch",unite:"ch"},puissance_kva:{label:"Puissance electrique kva",unite:"kVA"},capacite:{label:"Capacité",unite:"kgs"},kilometrage:{label:"Kilométrage",unite:"km"},marque_porteur:{label:"Marque porteur"},modele_porteur:{label:"Modèle porteur"},ptac:{label:"PTAC",unite:"kgs"},surface:{label:"Surface",unite:"m<sup>2</sup>"},ouverture_alim:{label:"Ouverture d'alimentation",unite:"mm"},nb_etages:{label:"Nombre d'étages"},debit_air:{label:"Débit d'air",unite:"l/min"},type_mat:{label:"Type de mât"},capacite_levage:{label:"Capacité de levage",unite:"kgs"},hauteur_levage:{label:"Hauteur de levage",unite:"m"},hauteur_travail:{label:"Hauteur de travail",unite:"m"},date_mec:{label:"Date de 1ère mise en circulation"},couple_levage:{label:"Couple de levage",unite:"Kgs/m"},type_energie:{label:"Type d'énergie",convert:{1:"Diesel",2:"Gaz",3:"Essence",4:"Electrique",5:"Autre"}}},c=[];return angular.forEach(b,function(b,d){if("object"==typeof a&&"undefined"!=a[d]&&""!=a[d]){var e={infos:b,value:a[d]};c.push(e)}}),c};a.getPriceAndUnit=function(a,b){var c={0:"&euro;",1:"&euro;",2:"$",3:"£",4:"руб"};return void 0==a||""==a||0==a?"Non indiqu&eacute;":Number(a).toLocaleString("fr-FR",{minimumFractionDigits:0})+" "+c[b]},a.getLabel=function(a){return a.label},a.getValue=function(a,b){return void 0!==b.convert?b.convert[a]:a};var j=i(a.unArticle);a.getParamsAnnonce=function(){return j},a.manual2={padding:0,transitionIn:"none",transitionOut:"none",type:"image",changeFade:0},a.prefixe_url_image="http://materiel.batiactu.com/uploads/photo_",a.openManual2=function(b){var c="http://materiel.batiactu.com/uploads/photo_";void 0!=b.prefixe_url_image&&""!=b.prefixe_url_image&&(c=b.prefixe_url_image),a.manual2gallery=[c+b.image,c+b.image2,c+b.image3,c+b.image4,c+b.image5,c+b.image6],h.fancyboxPlus()(a.manual2gallery,a.manual2)}}]),angular.module("appliMobileBatiActuApp").controller("LoginCtrl",["$scope","$location","$http","configSite","synchro","baLogs",function(a,b,c,d,e,f){a.user={email:"",password:""},$(window).off("orientationchange");var g=a.connexion=[];g.push({image:"images/image6.jpg"}),a.image_connexion="images/image6.jpg",a.identification=function(){var c={etat:"OK",info_user:{name:"Federer",firstname:"Roger"}};d.profile.authentificated=!0,"OK"==c.etat?(a.user.nom=c.info_user.name,a.user.prenom=c.info_user.firstname,a.user.isConnected=d.profile.authentificated,localStorage.setItem("user",JSON.stringify(a.user)),b.path("/home")):$("#erreur-connexion").removeClass("hide")}}]),angular.module("appliMobileBatiActuApp").controller("MotdepasseoublieCtrl",["$scope","$location","$http","configSite","synchro","baLogs",function(a,b,c,d,e,f){var g=a.connexion=[];g.push({image:"images/image6.jpg"}),a.image_connexion="images/image6.jpg",a.mdpoublie=function(){var a={etat:"OK"};"OK"==a.etat?b.path("/connexion"):$("#erreur-connexion").removeClass("hide")}}]),angular.module("appliMobileBatiActuApp").controller("DemandeDocCtrl",["$scope","ArticleFactory","$log","$routeParams","$route","$filter","$location",function(a,b,c,d,e,f,g){a.retourRecherche=function(b){g.path("/articles/"+a.article.id)}}]),jQuery(document).ready(function(){if(document.addEventListener("deviceready",function(){var a=document.body;angular.bootstrap(a,["appliMobileBatiActuApp"])},!1),"undefined"==typeof window.cordova){var a=document.body;angular.bootstrap(a,["appliMobileBatiActuApp"])}jQuery().UItoTop({easingType:"easeOutQuart"})});