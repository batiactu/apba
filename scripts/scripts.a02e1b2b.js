"use strict";angular.module("baLogs",["ngRoute","ui-notification"]).config(["$routeProvider","NotificationProvider",function(a,b){b.setOptions({delay:4e3,startTop:20,startRight:10,verticalSpacing:20,horizontalSpacing:20,positionX:"right",positionY:"top"}),a.when("/logs",{templateUrl:"views/baLogs.html",controller:"LogsCtrl"})}]).controller("LogsCtrl",["$scope","baLogs",function(a,b){a.logs=b}]).factory("baLogs",["Notification",function(a){var b={active:!0,logList:[],config:null,setConfig:function(a){this.config=a},activate:function(){this.log("Logs activés"),this.active=!0},unactivate:function(){this.active=!1,this.log("Logs désactivé")},log:function(){if(null!=this.config&&this.config.logs.debug){var a="Info";"string"==typeof arguments[1]&&-1!=["INFO","WARN","ERROR","DEBUG"].indexOf(arguments[1])&&(a=arguments[1]);if(this.active)for(var b=Date.now()/1e3|0,c=0;c<arguments.length;c++)"string"==typeof arguments[c]&&this.logList.unshift({date:b,type:a,message:arguments[c]})}},debug:function(a){null!=this.config&&"undefined"!=typeof this.config.logs.debug&&this.config.logs.debug&&this.log(a,"DEBUG")},error:function(a){this.log(a,"ERROR")},info:function(a){this.log(a,"INFO")},warning:function(a){this.log(a,"WARN")},notif_error:function(b){"string"==typeof b&&(b={message:b}),a.error(b)},notif_success:function(b){"string"==typeof b&&(b={message:b}),a.success(b)},notif_warning:function(b){"string"==typeof b&&(b={message:b}),a.warning(b)}};return b}]),angular.module("baTraduction",["baLogs"]).filter("baTranslate",["baTraduction",function(a){return function(b,c){return null!=a.listTraduction&&void 0!=a.listTraduction.trad&&void 0!=a.listTraduction.trad[b]&&""!=a.listTraduction.trad[b]?(("DESC"==b||"ASC"==b)&&(b=c+"_"+b),"0"==b&&(b="1"),a.listTraduction.trad[b]):b}}]).factory("baTraduction",["baLogs","$q","$http",function(a,b,c){var d={listTraduction:null,config:null,setConfig:function(a){this.config=a},getTraduction:function(){var a=this,d=b.defer(),e=a.config.traduction.protocoleWeb+a.config.traduction.UrlTrad.replace("#CODELANG#",a.config.traduction.lang);return a.config.loader.loading=!0,c.get(e).then(function(a,b){d.resolve(a.data)},function(b){a.config.logs.debug&&(console.log("erreur sur url "+e),console.log(b))})["finally"](function(){a.config.loader.loading=!1}),d.promise},majTrad:function(a){if(void 0!=a){var b=a();null!=b&&(d.listTraduction=b)}var c=d.getTraduction();c.then(function(b){null==d.listTraduction?d.listTraduction=b:void 0!=d.listTraduction.version&&void 0!=b.version&&d.listTraduction.version<b.version&&(d.config.logs.debug&&console.log("baTraduction : Nouvelle version du fichier : "+b.version),d.listTraduction=b),a(d.listTraduction)})}};return d}]),angular.module("webStorage",[]).factory("webStorage",function(){var a={set:function(a,b){localStorage.setItem(a,JSON.stringify(b))},get:function(a){var b=localStorage.getItem(a);if(void 0==b||null==b)return null;var c=null;try{c=JSON.parse(b)}catch(d){}return c},remove:function(a){localStorage.removeItem(a)},clearAll:function(){localStorage.clear()},getQty:function(){var a=0;return angular.forEach(localStorage,function(b){a+=b.length}),a}};return a}),angular.module("synchro",["webStorage","baLogs"]).factory("synchro",["webStorage","$q","baLogs",function(a,b,c){var d={listeSynchro:[],config:null,dateSynchro:function(){return Date.now()/1e3|0},setConfig:function(a){this.config=a},isStorageEnable:function(){return this.isActive()&&1==this.config.synchro.storageEnable&&"string"==typeof this.config.synchro.storageType},init:function(a){var b=this;"undefined"!=typeof a&&(b.config=a),b.isActive()&&angular.forEach(b.config.synchro.links,function(a){var c=null;if(null==c){var d=a.callback(a);if(b.listeSynchro[a.name]=d,b.isStorageEnable()&&void 0!=d&&(void 0==a.specificStorage||1!=a.specificStorage)){b.storageSet(a.name,d,!0);var e=b.dateSynchro();b.setConf("lastSynchro",e),void 0!=a.setTimeSynchro&&0!=a.setTimeSynchro&&(b.timeSynchro=a.setTimeSynchro)}}})},resynchronize:function(a,b){var c=this;"undefined"!=typeof b&&(c.config=b),c.isActive()&&angular.forEach(c.config.synchro.links,function(b){if(b.name==a){var d=null,e=c.get(b.name);if(null==d){var f=b.callback(b);if(null!=f&&f.then(function(){c.listeSynchro[b.name]=f},function(){c.listeSynchro[b.name]=e}),c.isStorageEnable()&&void 0!=f&&(void 0==b.specificStorage||1!=b.specificStorage)){null!=f&&f.then(function(){c.storageSet(b.name,f,!0)},function(){c.storageSet(b.name,e,!0)});var g=c.dateSynchro();c.setConf("lastSynchro",g),void 0!=b.setTimeSynchro&&0!=b.setTimeSynchro&&(c.timeSynchro=b.setTimeSynchro)}}}})},storageSet:function(b,c,d){"undefined"==typeof d&&(d=!0);switch(this.config.synchro.storageType){case"W":d?c.then(function(c){a.set(b,c)}):a.set(b,c);break;case"P":}},storageGet:function(b){switch(d.config.synchro.storageType){case"W":return a.get(b);case"P":}},storageDel:function(b){switch(d.config.synchro.storageType){case"W":return a.remove(b);case"P":}},storageClearAll:function(){var b=this;switch(b.config.synchro.storageType){case"W":return a.clearAll();case"P":}},storageQty:function(){var b=this;switch(b.config.synchro.storageType){case"W":return a.getQty();case"P":}},isActive:function(){return null==this.config||"undefined"==typeof this.config.synchro||"undefined"==typeof this.config.synchro.enabled||1!=this.config.synchro.enabled||"undefined"==typeof this.config.synchro.links?!1:!0},getConf:function(a){if(this.isStorageEnable()){var b=this.storageGet("conf_"+a);return b}},get:function(a,b){var c=this;if("undefined"!=typeof c.listeSynchro[a]&&null!=c.listeSynchro[a])return c.listeSynchro[a];if(c.isStorageEnable()){var d=c.storageGet(a);if("undefined"!=typeof d&&null!=d){void 0!=b&&void 0!=d[b]&&(d=d[b].obj);var e=c.getPromise(d);return c.listeSynchro[a]=e,e}}return null},getPromise:function(a){var c=b.defer();return c.resolve(a),c.promise},setConf:function(a,b){if(this.isStorageEnable()){this.storageSet("conf_"+a,b,!1)}},set:function(a,b,c){var d,e;if(void 0!=c){void 0==c.promise?(d=this.getPromise(c),e=c):(d=c.promise,e=c.obj),void 0==this.listeSynchro[a]&&(this.listeSynchro[a]=[]),this.listeSynchro[a][b]=d;var f=this.storageGet(a);null==f&&(f=[]),void 0==f&&(f=[]),f[b]=e,this.storageSet(a,f,!1)}else void 0==b.promise?(d=this.getPromise(b),e=b):(d=b.promise,e=b.obj),this.listeSynchro[a]=d,this.storageSet(a,e,!1)},clearAll:function(){this.storageClearAll(),this.listeSynchro=[]},getStockageQty:function(){var a={stockage:"NC",memoire:"NC"};return this.isStorageEnable()&&(a.stockage=this.storageQty()),this.isActive()&&(a.memoire=this.memoryQty()),a},memoryQty:function(){return c.log(window.performance.memory),0},reSync:function(){var a=this,b={};angular.forEach(a.config.synchro.noSyncList,function(c){b[c]=a.storageGet(c)}),this.clearAll(),angular.forEach(a.config.synchro.noSyncList,function(c){a.storageSet(c,b[c],!1)}),this.init(),this.setConf("lastSynchro",this.dateSynchro())},getInfoSynchro:function(){var a=this.getConf("lastSynchro");return a},cache:{nameCacheConfig:"configCache",get:function(a,b){if(void 0==b&&(b=!0),b&&this.outOfDate(this.getCacheName(a)))return null;var c=d.storageGet(this.getCacheName(a));return console.log("cache : "+this.getCacheName(a),c),c},set:function(a,b,c){this.outOfDate(this.getCacheName(a),c)&&(d.storageSet(this.getCacheName(a),b,!1),this.setTimeConfig(this.getCacheName(a),c))},getCacheName:function(a){return"cache_"+a},outOfDate:function(a,b){var c=d.storageGet(this.nameCacheConfig),e=Date.now();return null==c||"undefined"==typeof c[a]?!0:(void 0==b&&(b=c[a].timeToLeft),c[a].time+1e3*b<e?(console.log("OUT OF DATE : "+a,e,"<-- now ---< time >--- cache -->",c[a]),!0):!1)},setTimeConfig:function(a,b){var c=d.storageGet(this.nameCacheConfig),e=Date.now();return null==c&&(c={}),c[a]={time:e,timeToLeft:b},d.storageSet(this.nameCacheConfig,c,!1),!1}}};return d}]),angular.module("baConfigModule",["baLogs"]).factory("baConfig",["baLogs","$q","$http",function(a,b,c){var d={config:null,configExtPromise:null,setConfig:function(a){this.config=a},getConfig:function(){var a=this,d=b.defer();if(null!=a.configExtPromise)return a.configExtPromise;var e=this.config.extConfig.protocoleWeb+this.config.extConfig.Url;return a.config.loader.loading=!1,c.get(e).then(function(a,b){d.resolve(a.data)},function(b){a.config.logs.debug&&(console.log("erreur sur url "+e),console.log(b))})["finally"](function(){a.config.loader.loading=!1}),a.configExtPromise=d.promise,d.promise}};return d}]),angular.module("phonegapModule",[]).factory("baPhoneGap",["baLogs","synchro","$q",function(a,b,c){var d={connected:!1,connectFailed:!1,mediaRec:{obj:null,file:null,infos:null},config:null,_connection:{state:0,minDebit:!1,label:"Connexion inconnue"},mediaSyncInProgress:!1,messageInProgress:"hello ....",fileEntry:null,nativeURL:"",setConfig:function(a){this.config=a},isDevice:function(){return"object"==typeof window.cordova?(a.log("C'EST UN DEVICE"),!0):(a.log("CE N'EST PAS UN DEVICE"),!1)},deviceReady:function(a){"object"==typeof window.cordova&&document.addEventListener("deviceready",function(){"undefined"!=typeof a&&a()},!1)},isIOS:function(){return this.isDevice()&&"IOS"==device.platform.toUpperCase()},isAndroid:function(){return this.isDevice()&&"Android"==device.platform},isConnected:function(){var b=this,c=b.checkConnection();return b.connectFailed=b.connectFailed||1==b.connected&&0==c.state,b.connected=1==c.state,a.log("Est connecté : ",b.connected),b.connected},checkConnection:function(){var a=this;if(!a.isDevice())return{state:1,label:"WEB connection",minDebit:!1};if("object"==typeof window.cordova){a.config.logs.debug&&console.log(navigator.network.connection.type);var b=navigator.network.connection.type,c={};return c[Connection.UNKNOWN]={state:1,minDebit:!1,label:"Unknown connection"},c[Connection.ETHERNET]={state:1,minDebit:!0,label:"Ethernet connection"},c[Connection.WIFI]={state:1,minDebit:!0,label:"WiFi connection"},c[Connection.CELL_2G]={state:1,minDebit:!1,label:"Cell 2G connection"},c[Connection.CELL_3G]={state:1,minDebit:!0,label:"Cell 3G connection"},c[Connection.CELL_4G]={state:1,minDebit:!0,label:"Cell 4G connection"},c[Connection.CELL]={state:1,minDebit:!0,label:"Cellular connection"},c[Connection.NONE]={state:0,minDebit:!1,label:"No network connection"},c[b]}return a._connection},minDebitToTransfert:function(){var a=this,b=a.checkConnection();return b.minDebit},captureImageFromCamera:function(b){var c=this;this.deviceReady(function(){navigator.device.capture.captureImage(function(d){void 0!=b&&void 0!=b.funcOk&&(b.funcOk(),delete b.funcOk),a.log(d[0].localURL),c.processFile(d[0].localURL,c.config.media.MEDIA_TYPE_IMAGE,b)},c.errorHandler)})},captureImageProGallery:function(b){var c=this;this.deviceReady(function(){window.imagePicker.getPictures(function(d){a.log(d);for(var e=0,f=0;f<d.length;f++)a.log("Image URI: "+d[f]),c.processFile(d[f],c.config.media.MEDIA_TYPE_IMAGE,b),e++;e&&void 0!=b&&void 0!=b.funcOk&&(b.funcOk(),delete b.funcOk)},function(b){a.log("Error: "+b)})})},playAudio:function(a){var b=this;this.deviceReady(function(){var c=a;b.litAudio(c)})},litAudio:function(a){var b=this;this.deviceReady(function(){var c=a;null!=b.mediaRec.obj&&b.stopAudio(),b.createMedia(c),b.mediaRec.obj.play()})},stopAudio:function(){var a=this;this.deviceReady(function(){null!=a.mediaRec.obj&&(a.mediaRec.obj.stop(),a.mediaRec.obj.release(),a.mediaRec.obj=null,a.mediaRec.file=null)})},captureAudio:function(b){var c=this;this.deviceReady(function(){a.log("Commencement enregistrement");var d=".wav";c.isAndroid()?d=".3gp":c.isIOS()&&(d=".wav");var e="cdvfile://localhost/persistent/"+c.config.media.directory+"/"+c.config.audio.directory+"/"+c.config.audio.prefix+"-"+c.getDateName()+d;c.createMedia(e),c.mediaRec.info=b,c.mediaRec.file=e,c.mediaRec.obj.startRecord()})},stopRecordAudio:function(b){var c=this;this.deviceReady(function(){a.log("Audio() : StopRecordAudio "),c.mediaRec.obj.stopRecord(),c.mediaRec.obj.release(),c.mediaRec.obj=null})},verifRecordAudio:function(){var b=this;this.deviceReady(function(){a.log("Audio() : VerifRecordAudio "),null!=b.mediaRec.obj?(b.mediaRec.obj.getCurrentPosition(function(a){},function(a){}),b.mediaRec.obj.play()):(b.createMedia(b.mediaRec.file),b.mediaRec.obj.play())})},pauseRecordAudio:function(){var b=this;this.deviceReady(function(){a.log("Audio() : PauseRecordAudio "),null!=b.mediaRec.obj&&b.mediaRec.obj.pause()})},validRecordAudio:function(b){var c=this;this.deviceReady(function(){a.log("Audio() : validRecordAudio "),null!=c.mediaRec.obj&&(c.mediaRec.obj.stop(),c.mediaRec.obj.release(),c.mediaRec.obj=null),c.processFile(c.mediaRec.file,c.config.media.MEDIA_TYPE_AUDIO,b)})},getPosition:function(a){var b=this;null!=b.mediaRec.obj&&b.mediaRec.obj.getCurrentPosition(a)},getDuration:function(a){var b=this;return b.mediaRec.obj?b.mediaRec.obj.getDuration():-1},createMedia:function(b,c){var d=this;this.deviceReady(function(){d.mediaRec.obj=new Media(b,function(){a.log("createMedia() : Audio Success"),"function"==typeof c&&c()},function(b){a.log("createMedia(): Audio Error : "+b)},function(b){a.log("createMedia(): Audio Status : ",b)})})},getDateName:function(){var a=new Date,b=a.getTime();return b},processFile:function(b,c,d){var e=this;this.deviceReady(function(){e.config.logs.debug&&console.log("MediaFileURL = ",b),window.resolveLocalFileSystemURL(b,function(b){e.moveFileToLocalDir(b,c,function(f){a.log("fin deplacement",b.name," --> ",f.name),f.type=c,e.transfert(f,d)})},e.resOnError)})},storageSetAddToList:function(a,c){var d=this;d.config.logs.debug&&console.log(a,c);var e=b.storageGet(a);null==e&&(e=[]),e.push(c),b.storageSet(a,e,!1)},storageSetDelToList:function(a,c){var d=this,e=b.storageGet(a);null==e&&(e=[]);var f=[];angular.forEach(e,function(a){d.config.logs.debug&&console.log("verif pour supp localto sync : ",a.name!=c,a.name,c),a.name!=c&&f.push(a)}),b.storageSet(a,f,!1)},storageGetListToSynchronize:function(a){return b.storageGet(a)},synchronizeMedia:function(b,c){var d=this;this.deviceReady(function(){if(d.mediaSyncInProgress)return void a.log("Synchro media déjà en cours");if(d.mediaSyncInProgress=!0,a.log("Synchro média : en cours  : "),"string"!=typeof b&&(b=d.config.media.synchroName),1==c||d.minDebitToTransfert()||1!=d.config.media.useSynchro){var e=d.storageGetListToSynchronize(b);null==e||0==e.length?a.log("---------------> rien à faire"):(a.log("---------------> début transfert"),angular.forEach(e,function(a){d.config.logs.debug&&console.log("Valeur dans synchro",a),d.transfert(a,a.infos,!0)}))}else a.log("Connexion insuffisante"),a.notif_warning("Synchronisation des fichiers en attente : connexion insuffisante");d.mediaSyncInProgress=!1})},moveFileToLocalDir:function(b,c,d){var e=this,f=new Date,g=(f.getTime(),""),h=e.config.media.directory+"/";this.deviceReady(function(){switch(c){case e.config.media.MEDIA_TYPE_IMAGE:g=e.config.photo.prefix+"-"+e.getDateName()+".jpg",h+=e.config.photo.directory;break;case e.config.media.MEDIA_TYPE_AUDIO:var f=".wav";e.isAndroid()?f=".3gp":e.isIOS()&&(f=".wav"),g=e.config.audio.prefix+"-"+e.getDateName()+f,h+=e.config.audio.directory}e.config.logs.debug&&(console.log("type = ",c),console.log("newFileName = ",g),console.log("myFolderApp = ",h)),""!=g?window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(a){a.root.getDirectory(h,{create:!0,exclusive:!1},function(a){e.config.logs.debug&&console.log(a),b.moveTo(a,g,function(a){e.config.logs.debug&&console.log("+++++",a),d(a)},function(){e.config.logs.debug&&console.log("ERR+++++",arguments)})},e.errorHandler)},e.errorHandler):a.log("Error name File : empty for temporary file : "+b.fullPath)})},createFile:function(b,c,d){var e=this;this.deviceReady(function(){window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(f){a.log("create dir if not exist"+b),f.root.getDirectory(b,{create:!0,exclusive:!1},function(f){a.log("create file if not exist"+c),f.filesystem.root.getFile(b+"/"+c,{create:!0},function(){null!=d&&d(),e.config.logs.debug&&console.log("+333333++++",arguments)},function(){e.config.logs.debug&&console.log("ERR+++333333++",arguments)})},e.errorHandler)},e.errorHandler)})},listRepertory:function(a){var b=this;this.deviceReady(function(){var c=this.config.media.directory;void 0!=a&&(c=a),window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(a){a.root.getDirectory(c,{create:!1,exclusive:!1},function(a){b.config.logs.debug&&console.log(a);var c=a.createReader();c.readEntries(function(a){var b;for(b=0;b<a.length;b++)console.log(a[b].name)},function(){b.config.logs.debug&&console.log("ERR+++++",arguments)})},b.errorHandler)},b.errorHandler)})},loadMedia:function(a,b){var c,d,e;for(c=0,e=a.length;e>c;c+=1)d=a[c].fullPath,$(b).attr("src",d)},errorHandler:function(b){a.log("erroHanler : Error : ",b)},transfert:function(b,c,d){var e=this;this.deviceReady(function(){if(("undefined"==typeof d||d!==!0)&&1==e.config.media.useSynchro){if("undefined"!=typeof d&&1==d)return;var f={type:b.type,nativeURL:b.nativeURL,name:b.name,infos:c};return e.config.logs.debug&&console.log("on stoke en local",f),void e.storageSetAddToList(e.config.media.synchroName,f)}if(e.config.logs.debug&&console.log("veirf si cnsx ok"),e.minDebitToTransfert()||1!=e.config.media.useSynchro){e.config.logs.debug&&(console.log("debut transfert"),console.log(b));var g=new FileTransfer;"undefined"!=typeof c&&null!==c?c.fileName=b.name:c={fileName:b.name},e.messageInProgress="Tranfert du fichier : "+c.fileName;var h=e.config.media.url_upload(c);e.config.logs.debug&&console.log(h),e.config.loader.uploading=!0,g.upload(b.nativeURL,h,function(b){a.log("Upload success : "+c.fileName+"  -- "+b.responseCode),a.log(b.bytesSent+" bytes sent"),e.messageInProgress="Tranfert du fichier : "+c.fileName+" : OK : "+b.bytesSent+" octets envoyés",e.config.logs.debug&&console.log("Supp ?????????????",d,e.config.media.useSynchro),"undefined"!=typeof d&&1==d&&(e.config.logs.debug&&console.log("Supp !!!!!!!!!!!!!!!"),e.storageSetDelToList(e.config.media.synchroName,c.fileName)),e.config.loader.uploading=!1},function(d){a.log(d),a.log("Error uploading file "+b.nativeURL+": "+d.code),e.messageInProgress="Tranfert du fichier : "+c.fileName+" : ERREUR",a.notif_error({tile:"Transfert de media",message:"Erreur du transfert, tentative ultérieure."}),e.config.loader.uploading=!1},c)}})},downloadMediaURL:function(a,b,c){var d=this;if(null!=a||null!=b||null!=c){var e=navigator.connection.type;e!=Connection.NONE&&d.download(a,b,c)}},download:function(a,b,c){function d(d){var g=encodeURI(a),i=(g.substr(g.lastIndexOf(".")+1),d.root);i.getDirectory(b,{create:!0,exclusive:!1},e,f);var j=d.root,k=j.nativeURL;h.nativeUrl=k,k=k+"/"+b+"/"+c;var l=b+"/"+c;d.root.getFile(l,{create:!1,exclusive:!1},function(a){h.config.logs.debug&&console.log("FileExist",a)},function(a){h.config.logs.debug&&console.log("FileExist",a),h.filetransfer(g,k)})}function e(a){}function f(a){h.config.logs.debug&&console.log("Unable to create new directory: ",a)}function g(a){h.config.logs.debug&&console.log(a)}var h=this;window.requestFileSystem(LocalFileSystem.PERSISTENT,0,d,g)},filetransfer:function(b,c){var d=this;a.log("Download file : "+b);var e=new FileTransfer;d.config.loader.downloading=!0,e.download(b,c,function(a){d.config.logs.debug&&console.log("download complete: ",a),d.config.loader.downloading=!1},function(a){d.config.logs.debug&&console.log("download error source ",a),d.config.loader.downloading=!1})},setNativeURL:function(){var a=this;this.deviceReady(function(){function b(b){var c=b.root;a.config.logs.debug&&console.log("NATIAVE_URL",c.nativeURL),a.nativeURL=c.nativeURL}function c(b){a.config.logs.debug&&console.log(b)}window.requestFileSystem(LocalFileSystem.PERSISTENT,0,b,c)})}};return d}]),angular.module("baPushModule",["baLogs","phonegapModule"]).factory("baPush",["baLogs","$q","$http","baPhoneGap",function(a,b,c,d){var e={pushObject:null,listePush:[],config:null,init:function(){return d.isDevice()?(this.pushObject=PushNotification.init({android:{senderID:this.config.push.senderId},ios:{alert:"true",badge:"true",sound:"true"},windows:{}}),this.pushObject):null},unRegisterPush:function(a,b){null!=this.pushObject&&this.pushObject.unregister(a,b)},setConfig:function(a){this.config=a},getAllNotifications:function(a){return this.listePush},addNotification:function(a){this.listePush.push(a)},setPushToken:function(a){console.log("TOKEN SET ==== ",a),localStorage.setItem("pushToken",a),this.config.push.pushNotRegister=!1},removePushToken:function(){console.log("TOKEN REM "),localStorage.removeItem("pushToken"),this.config.push.pushNotRegister=!0},getPushToken:function(){var a=localStorage.getItem("pushToken");return console.log("TOKEN GET ==== ",a),"undefined"==typeof a||""==a?(this.config.push.pushNotRegister=!0,null):(this.config.push.pushNotRegister=!1,a)}};return e}]),angular.module("baFctModule",[]).factory("baFctFactory",["$location",function(a){String.prototype.replaceAt=function(a,b){return this.substr(0,a)+b+this.substr(a+b.length)},String.prototype.sansAccent=function(){for(var a=[/[\300-\306]/g,/[\340-\346]/g,/[\310-\313]/g,/[\350-\353]/g,/[\314-\317]/g,/[\354-\357]/g,/[\322-\330]/g,/[\362-\370]/g,/[\331-\334]/g,/[\371-\374]/g,/[\321]/g,/[\361]/g,/[\307]/g,/[\347]/g],b=["A","a","E","e","I","i","O","o","U","u","N","n","C","c"],c=this,d=0;d<a.length;d++)c=c.replace(a[d],b[d]);return c};var b={version:function(){console.log("VERSION BA FCT : 1111")},goPage:function(b){a.path(b)}};return b}]),angular.module("appliMobileBatiActuApp",["ngRoute","ngSanitize","ui.bootstrap","ngAside","ngTouch","fancyboxplus","synchro","baLogs","baTraduction","baConfigModule","baPushModule","baFctModule","angular-carousel"]).value("configFiltre",{filtre:{sort:"date",sort_order:"DESC"},filtreGroupe:{entity_type:"reseau_groupe",sort:"date",sort_order:"DESC"},filtreFilactu:{},filtreRealisation:{},affichage:{},getFilterToChange:function(a){var b=this.filtre;return"undefined"!=typeof a&&("undefined"!=typeof this[a]?b=this[a]:(console,log("Erreur filtre inconnu : ",a))),b},add:function(a,b,c){var d=this.getFilterToChange(c);d[a]=b,this.maj()},remove:function(a,b){var c=this.getFilterToChange(b);"object"==typeof a?angular.forEach(a,function(a,b){delete c[a]}):delete c[a],this.maj()},maj:function(){"function"==typeof this.getListe?this.getListe():console.log("Pas de rechargement de la liste")},removeAllFilters:function(a){var b=this.getFilterToChange(a);angular.forEach(this.filtre,function(a,c){delete b[c]}),b.sort="date",b.sort_order="DESC",this.maj()},noRefresh:function(){return this.getListe=function(){console.log("No refresh")},this}}).value("configSite",{version:"0.0.1",synchro:{enabled:!0,links:[],storageEnable:!0,storageType:"W",noSyncList:["user"]},profile:{authentificated:!1},analytics:{tag:""},push:{senderId:"366716046205",pushNotRegister:!0,android:{},ios:{}},protocoleWeb:"http://",msgError:!1,Url:{reseauCnx:"",emploi:"",wsSolr:"http://dev11.batiactu.com/solarium3-preprod/scripts/ws.php",pub:"http://capinfoproreport.batiactu.com/cap_pub/scripts/get-pub-support-emplacement.php?e=DROITE1&JSON",urlWsReseau:"demo.batiactu.info/wsRT/msa2632145ddftr.php",urlWsLogin:"reseau.batiactu.com"},traduction:{lang:"FR",UrlTrad:"scripts/config/trad.json",protocoleWeb:""},extConfig:{Url:"scripts/config/config.json",protocoleWeb:""},logs:{debug:!0,viewLogs:!1,debugUpload:!1,debugUrl:""},loader:{loading:!1,uploading:!1,downloading:!1,interpage:!1}}).run(["$rootScope","configSite","baTraduction","synchro","baLogs","baConfig","baPhoneGap","baPush","PushFactory","ConfigFactory","configFiltre","FonctionsFactory","LoginFactory","$location",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){a.$on("$viewContentLoaded",function(){jQuery("html, body").animate({scrollTop:0},0)}),a.$on("$locationChangeStart",function(a,b,c){console.log("$locationChangeStart ---> ",arguments),"slider"!=b.substr(b.lastIndexOf("#/")+2)&&"connexion"!=b.substr(b.lastIndexOf("#/")+2)&&"inscription"!=b.substr(b.lastIndexOf("#/")+2)&&"login"!=b.substr(b.lastIndexOf("#/")+2)&&(m.mustLog()?(a.preventDefault(),console.log("NON LOGGE"),n.path("/login")):console.log("OK LOGGE"))}),a.changeTemplate=function(a,b){return b.replace("entity_type",a)},a.infoPush={token:"vide"},a.menuToggle={},a.pref_user={themes:{},rubriques:{},types_realisation:{},fabricants:{}},a.realisations_preferees={},a.config=angular.extend(b,j),angular.extend(a,l),a.configFiltre=k,e.setConfig(b),g.setConfig(b),d.setConfig(b),c.setConfig(b),h.setConfig(b);var o=h.getPushToken();if(null!=o){var p=h.init();null!=p?(p.on("registration",i.registrationHandler),p.on("notification",i.notificationHandler),p.on("error",i.errorHandler)):e.notif_error("Erreur initialisation notifications.")}f.setConfig(b),f.getConfig().then(function(b){a.config.extConfig.data=b,console.log("Config LOCALE ",a.config.extConfig)}),c.majTrad(function(a){return"undefined"!=typeof a?(d.storageSet("trads",a,!1),null):d.storageGet("trads")}),b.isDevice=g.isDevice();var q=d.get("login");console.log(q),null!=q&&q.then(function(a){m.setProfile(a),m.login("verif").then(function(){})})}]).config(["$routeProvider","$httpProvider",function(a,b){var c=!1,d=!1,e=!1;b.interceptors.push(["$q",function(a){return{request:function(a){var b;return-1!==a.url.indexOf(".html")&&-1!==a.url.indexOf("views")&&e&&(a.url="http://192.168.3.103/appli_mobile_batiactu/app/"+a.url,console.log("HTML === ",a)),(d||-1!==(b=a.url.indexOf("php?"))||-1!==(b=a.url.indexOf(".html"))&&1==c)&&console.log(a),a},response:function(a){var b=0,e=" ----> ";if(d||-1!==(b=a.config.url.indexOf("php?"))||-1!==(b=a.config.url.indexOf(".html"))&&1==c){var f=a.config.url.substr(b);e=" ----> "+f,console.log(e,a)}return a}}}]);var f={data:["baConfig",function(a){return a.getConfig()}]};a.when("/login",{redirectTo:"/slider"}).when("/slider",{templateUrl:"views/slider.html",controller:"SliderCtrl",resolve:f}).when("/connexion",{templateUrl:"views/connexion.html",controller:"LoginCtrl",resolve:f}).when("/inscription",{templateUrl:"views/inscription.html",controller:"LoginCtrl",resolve:f}).when("/motdepasseoublie",{templateUrl:"views/motdepasseoublie.html",controller:"MotdepasseoublieCtrl",resolve:f}).when("/home",{templateUrl:"views/home.html",controller:"ArticlesCtrl",resolve:f}).when("/photos",{templateUrl:"views/photos.html",controller:"ArticlesCtrl",resolve:f}).when("/actualites",{templateUrl:"views/home.html",controller:"ArticlesCtrl",resolve:f}).when("/produits",{templateUrl:"views/home.html",controller:"ArticlesCtrl",resolve:f}).when("/realisations",{templateUrl:"views/home.html",controller:"ArticlesCtrl",resolve:f}).when("/formations",{templateUrl:"views/home.html",controller:"ArticlesCtrl",resolve:f}).when("/materiels",{templateUrl:"views/home.html",controller:"ArticlesCtrl",resolve:f}).when("/offres-emploi",{templateUrl:"views/home.html",controller:"ArticlesCtrl",resolve:f}).when("/articles/:id",{templateUrl:"views/article.html",controller:"ArticleDetailsCtrl",resolve:f}).when("/articles/:id/:page",{templateUrl:"views/article.html",controller:"ArticleDetailsCtrl",resolve:f}).when("/articles/formation/demande-doc/:id",{templateUrl:"views/demande_doc.html",controller:"ArticleDetailsCtrl",resolve:f}).when("/profil",{templateUrl:"views/profil.html",controller:"ProfilCtrl",resolve:f}).when("/compte",{templateUrl:"views/compte.html",controller:"CompteCtrl",resolve:f}).when("/filactu",{templateUrl:"views/filactu.html",controller:"FilActuCtrl",resolve:f}).when("/gestionFilActu",{templateUrl:"views/gestionFilActu.html",controller:"GestionFilActuCtrl",resolve:f}).when("/discussions",{templateUrl:"views/discussions.html",controller:"DiscussionsCtrl",resolve:f}).when("/new_discussion",{templateUrl:"views/new_discussion.html",controller:"DiscussionsCtrl",resolve:f}).when("/gestion_realisations",{templateUrl:"views/realisations.html",controller:"RealisationsCtrl",resolve:f}).when("/ajout_realisation",{templateUrl:"views/realisations/ajout_realisation.html",controller:"RealisationsCtrl",resolve:f}).when("/mes_realisations",{templateUrl:"views/realisations/mes_realisations.html",controller:"RealisationsCtrl",resolve:f}).when("/mes_groupes",{templateUrl:"views/groupes/mes_groupes.html",controller:"MonReseauCtrl",resolve:f}).when("/realisations_preferees",{templateUrl:"views/realisations/mes_realisations_preferees.html",controller:"RealPrefCtrl",resolve:f}).when("/groupes",{templateUrl:"views/groupes.html",controller:"GroupesCtrl",resolve:f}).when("/enCoursDeveloppement",{templateUrl:"views/enCoursDeveloppement.html"}).when("/parametres_appli",{templateUrl:"views/parametres_appli.html"}).when("/conditions",{templateUrl:"views/conditions.html"}).when("/propos",{templateUrl:"views/propos.html"}).when("/contact",{templateUrl:"views/contact.html"}).otherwise({redirectTo:"/home"})}]),angular.module("appliMobileBatiActuApp").factory("ArticleFactory",["$http","$q","configSite",function(a,b,c){var d={URL:"",articles:!1,filterOld:"",article:[],facets:!1,nbArtMax:36,nbPub:8,articlePromise:null,entity_default:"article_edito OR produitheque_produit OR reseau_realisation OR formation_annonce OR materiel_annonce OR emploi_annonce",emplacementPub:function(a){if(a>0){var b=d.nbArtMax/d.nbPub,c=a%Math.floor(b);return 0==c}return!1},getCommonArticles:function(a,b,c){var d=this;this.getArticles(b).then(function(b){c(b),d.getThemes().then(function(b){a.affichage.themes=b}),d.getRubriques().then(function(b){a.affichage.rubriques=b}),d.getTypesRealisation().then(function(b){a.affichage.types_realisation=b}),d.getTypesTravaux().then(function(b){a.affichage.types_travaux=b}),d.getEntityTypes().then(function(b){a.affichage.entity_types=b}),d.getFabricants().then(function(b){a.affichage.fabricants=b}),d.getCategories().then(function(b){a.affichage.categories=b})})},getArticles:function(e){c.loader.loading=!0;var f=b.defer();if(this.articlePromise=null,"undefined"!=typeof e&&angular.toJson(e)!=d.filterOld&&(d.filterOld=angular.toJson(e),d.articles=!1),d.articles!==!1)f.resolve(d.articles),c.loader.loading=!1;else{var g=c.Url.wsSolr+"?nb_item="+d.nbArtMax;if("undefined"!=typeof e){var h="date";"undefined"!=typeof e.keywords&&(g=g+"&KEYWORDS="+e.keywords),void 0!==e.sort&&(h=e.sort),g=g+"&SORT_ORDER="+h+"|"+(e.sort_order?e.sort_order:"DESC"),"undefined"!=typeof e.theme&&(g=g+"&themeFILTER="+encodeURIComponent(e.theme)),g="undefined"!=typeof e.entity_type?g+"&ENTITY="+e.entity_type:g+"&ENTITY="+d.entity_default,"undefined"!=typeof e.rubrique&&(g=g+"&rubriqueFILTER="+e.rubrique),"undefined"!=typeof e.type_realisation&&(g=g+"&type_realFILTER="+e.type_realisation),"undefined"!=typeof e.type_travaux&&(g=g+"&type_travFILTER="+e.type_travaux),"undefined"!=typeof e.fabricant&&(g=g+"&fabricantFILTER="+e.fabricant),"undefined"!=typeof e.categorie&&(g=g+"&categorieFILTER="+encodeURIComponent(e.categorie)),"undefined"!=typeof e.page&&(g=g+"&N="+e.page),"undefined"!=typeof e.manual&&(g=g+"&manualFILTER="+e.manual)}else g=g+"&ENTITY="+d.entity_default;d.URL=g,a.get(g).then(function(a,b){"undefined"!=typeof a.data&&(d.articles=a.data,"undefined"!=typeof a.data.facets&&(d.facets=a.data.facets)),""==d.articles||0==d.articles?f.reject("Désolé, votre recherche n'a pas abouti."):f.resolve(d.articles)},function(a,b){f.reject("Impossible de récupérer les articles")})["finally"](function(){c.loader.loading=!1})}return this.articlePromise=f.promise,f.promise},getArticle:function(e){var f=b.defer();return void 0!==d.article[e]?f.resolve(d.article[e]):a.get(c.Url.wsSolr+"?ID="+e).success(function(a,b){d.article[e]=a.items,f.resolve(d.article[e])}).error(function(a,b){f.reject("Impossible de récupérer l'article")}),f.promise},getFacets:function(){var a=b.defer();return null!=this.articlePromise?this.articlePromise.then(function(){0!=d.facets&&a.resolve(d.facets)}):a.reject("Pas d'articles recherchés"),a.promise},getEntityTypes:function(){var a=b.defer();return null!=this.articlePromise?this.articlePromise.then(function(){0!=d.facets&&"undefined"!=typeof d.facets.entity_types&&d.facets.entity_types!==!1&&a.resolve(d.facets.entity_types);
}):a.reject("Pas d'articles recherchés"),a.promise},getThemes:function(){var a=b.defer();return null!=this.articlePromise?this.articlePromise.then(function(){0!=d.facets&&"undefined"!=typeof d.facets.theme&&d.facets.theme!==!1&&a.resolve(d.facets.theme)}):a.reject("Pas d'articles recherchés"),a.promise},getRubriques:function(){var a=b.defer();return null!=this.articlePromise?this.articlePromise.then(function(){0!=d.facets&&"undefined"!=typeof d.facets.rubrique&&d.facets.rubrique!==!1&&a.resolve(d.facets.rubrique)}):a.reject("Pas d'articles recherchés"),a.promise},getTypesRealisation:function(){var a=b.defer();return null!=this.articlePromise?this.articlePromise.then(function(){0!=d.facets&&"undefined"!=typeof d.facets.type_realisation&&d.facets.type_realisation!==!1&&a.resolve(d.facets.type_realisation)}):a.reject("Pas d'articles recherchés"),a.promise},getTypesTravaux:function(){var a=b.defer();return null!=this.articlePromise?this.articlePromise.then(function(){0!=d.facets&&"undefined"!=typeof d.facets.type_travaux&&d.facets.type_travaux!==!1&&a.resolve(d.facets.type_travaux)}):a.reject("Pas d'articles recherchés"),a.promise},getFabricants:function(){var a=b.defer();return null!=this.articlePromise?this.articlePromise.then(function(){0!=d.facets&&"undefined"!=typeof d.facets.fabricant&&d.facets.fabricant!==!1&&a.resolve(d.facets.fabricant)}):a.reject("Pas de fabricant"),a.promise},getCategories:function(){var a=b.defer();return null!=this.articlePromise?this.articlePromise.then(function(){0!=d.facets&&"undefined"!=typeof d.facets.categorie&&d.facets.categorie!==!1&&a.resolve(d.facets.categorie)}):a.reject("Pas d'articles recherchés"),a.promise}};return d}]),angular.module("appliMobileBatiActuApp").factory("ConfigFactory",["configSite",function(a){var b={getEntityType:function(b,c){return a.extConfig.data.configEntityType[b][c]},getEntityTypeName:function(b,c){return a.extConfig.data.configEntityType[b][c]},getEntityTypeList:function(){var b=[];return angular.forEach(a.extConfig.data.configEntityType,function(a,c){b.push(c)}),b},getEntityTypeNameList:function(b,c){var d=[];return void 0==c&&(c=!1),angular.forEach(a.extConfig.data.configEntityType,function(a,e){if(void 0!=a&&void 0!=a[b]&&0!=a[b].length)if(c){var f={entityType:e,name:b,value:a[b]};d.push(f)}else d.push(a[b])}),d}};return b}]),angular.module("appliMobileBatiActuApp").factory("PubFactory",["$http","$q","configSite",function(a,b,c){var d={pubs:!1,getPubs:function(){var e=b.defer();return d.pubs!==!1?d.pubs:(a.get(c.Url.pub).success(function(a,b){var c=[];angular.forEach(a,function(a,b){-1==a.fichier.indexOf("swf")&&""!=a.fichier&&(0==c&&(c=[]),c.push(a))}),e.resolve(c)}).error(function(a,b){e.reject("Impossible de récupérer les pubs")}),d.pubs=e.promise,e.promise)},getRandomPub:function(a){var b=Math.floor(Math.random()*a.length)+1;return a[b]}};return d}]),angular.module("appliMobileBatiActuApp").factory("CompteFactory",["$http","$rootScope","$q","configSite",function(a,b,c,d){var e={};return e}]),angular.module("appliMobileBatiActuApp").factory("RealisationFactory",["$http","$rootScope","$q","configSite",function(a,b,c,d){var e={URL:"",articles:!1,article:[],entity_types:!1,typesRealisation:!1,typesTravaux:!1,getArticles:function(f){b.config.loader.loading=!0;var g=c.defer();if("undefined"!=typeof f&&angular.toJson(f)!=e.filterOld&&(e.filterOld=angular.toJson(f),e.articles=!1),e.articles!==!1)g.resolve(e.articles),b.config.loader.loading=!1;else{var h=d.Url.wsSolr+"?nb_item=36&ENTITY=reseau_realisation";"undefined"!=typeof f&&("undefined"!=typeof f.type_realisation&&(h=h+"&type_realFILTER="+f.type_realisation),"undefined"!=typeof f.type_travaux&&(h=h+"&type_travFILTER="+f.type_travaux),"undefined"!=typeof f.page&&(h=h+"&N="+f.page),"undefined"!=typeof f.manual&&(h=h+"&manualFILTER="+f.manual)),a.get(h).success(function(a,c){e.articles=a,"undefined"!=typeof a&&"undefined"!=typeof a.facets&&("undefined"!=typeof a.facets.type_realisation&&(e.typesRealisation=a.facets.type_realisation),"undefined"!=typeof a.facets.type_travaux&&(e.typesTravaux=a.facets.type_travaux)),""==e.articles&&(e.articles="Désolé, votre recherche n'a pas abouti."),g.resolve(e.articles),b.config.loader.loading=!1}).error(function(a,b){g.reject("Impossible de récupérer les articles")})}return g.promise},getArticle:function(b){var f=c.defer();return void 0!==e.article[b]?f.resolve(e.article[b]):a.get(d.Url.wsSolr+"?ID="+b).success(function(a,c){e.article[b]=a.items,f.resolve(e.article[b])}).error(function(a,b){f.reject("Impossible de récupérer l'article")}),f.promise},getTypesRealisation:function(){var a=c.defer();return setTimeout(function(){a.resolve(e.typesRealisation)},1e3),a.promise},getTypesTravaux:function(){var a=c.defer();return setTimeout(function(){a.resolve(e.typesTravaux)},1e3),a.promise}};return e}]),angular.module("appliMobileBatiActuApp").factory("PushFactory",["$http","$q","configSite","baPush","baLogs",function(a,b,c,d,e){var f={registrationHandler:function(a){var b=d.getPushToken();(null==b||b!=a.registrationId)&&(console.log("registrationHandler",a),d.setPushToken(a.registrationId))},errorHandler:function(){console.log("errorHandler ",arguments)},notificationHandler:function(a){e.notif_success(a.message),console.log("notificationHandler",a)},unRegisterPushHandler:function(a){console.log("unRegisterPushHandler",a),d.removePushToken()}};return f}]),angular.module("appliMobileBatiActuApp").factory("FonctionsFactory",["baFctFactory",function(a){var b={fixText:function(a,b){return a.substr(0,b)+"..."},int_val:parseInt,Math:window.Math,triFavoris:function(a){var b=function(a,b){return a.name<b.name?-1:a.name==b.name?0:1};if(void 0==a||0==a)return[];var c=a.sort(b);return c},repeteFakeArticles:function(a){return new Array(a)}};return angular.extend(b,a)}]),angular.module("appliMobileBatiActuApp").factory("FilActuFactory",["$http","$rootScope","$q","ArticleFactory","synchro","ConfigFactory",function(a,b,c,d,e,f){var g={facets:!1,userPrefName:"user_preference",getAllFacets:function(){var a=c.defer(),b=null;return null!=b?a.resolve(b):d.getArticles().then(function(c){d.getFacets().then(function(c){b=g.transform(c),console.log("NEW FAXCTETS",b),e.cache.set("facets",b,14400),a.resolve(b)})}),a.promise},transform:function(a){var b={};return angular.forEach(a,function(a,c){b[c]=[],angular.forEach(a,function(a,d){var e={};e.name=a.name,e.checked=!1,b[c].push(e)})}),b},getUserPref:function(){var a=e.storageGet(this.userPrefName);return a},setUserPref:function(a){e.storageSet(this.userPrefName,a,!1)},delAllUserPref:function(){e.storageDel(this.userPrefName)},checkEntityTypeInList:function(a){var b=f.getEntityTypeNameList("facetList");return(void 0==a||null==a)&&(a={}),angular.forEach(b,function(b){angular.forEach(b,function(b){void 0==a[b]&&(a[b]=[])})}),a}};return g}]),angular.module("appliMobileBatiActuApp").factory("LoginFactory",["synchro","configSite","$q","$rootScope","baLogs","$http",function(a,b,c,d,e,f){var g={getSynchoLogin:function(){return null},mustLog:function(){var a=0==b.profile.authentificated;return a&&e.log("go Login"),a},hasAbo:function(){return b.profile.hasAbo},setProfile:function(c){angular.forEach(c,function(a,c){b.profile[c]=a}),a.set("login",b.profile)},login:function(){var a=c.defer(),d=this,e={email:b.profile.login,password:b.profile.password,deviceid:"WEB"},g=b.protocoleWeb+b.Url.urlWsLogin+"/ws/index.php?action=login&object=membres";return b.loader.loading=!0,f({method:"POST",url:g,headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(c){var e=c.data;console.log(e),"undefined"!=typeof e&&void 0!=e.status&&200==e.status?(d.setProfile({authentificated:!0,userId:e.id,nom:e.nom,prenom:e.prenom,status:e.status_membre,token:e.token,login:b.profile.login,email:b.profile.login,password:b.profile.password}),a.resolve("ok")):(console.log("Erreur login"),a.reject("Erreur login"))},function(c){b.logs.debug&&(console.log("erreur sur url "+g),console.log(c)),a.reject("Erreur login")})["finally"](function(){b.loader.loading=!1}),a.promise},getMesGroupes:function(){var a=c.defer(),d={email:b.profile.login,token:b.profile.token},e=b.protocoleWeb+b.Url.urlWsLogin+"/ws/index.php?action=my_groupes&object=membres";return b.loader.loading=!0,f({method:"POST",url:e,headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(d)}).then(function(b){var c=b.data;"object"==typeof c&&"object"==typeof c.groupes?a.resolve(c.groupes):(console.log("Erreur login"),a.reject("Erreur login"))},function(c){b.logs.debug&&(console.log("erreur sur url "+e),console.log(c)),a.reject("Erreur ws groupes")})["finally"](function(){b.loader.loading=!1}),a.promise}};return g}]),angular.module("appliMobileBatiActuApp").filter("range",function(){return function(a,b){b=parseInt(b);for(var c=1;b>=c;c++)a.push(c);return a}}).filter("replaceCharacter",function(){return function(a){return void 0!=a?a.replace(/\r\n/g,"<br>").replace(/\t/g,"&nbsp&nbsp&nbsp&nbsp").replace("[PUB]"," ").replace("[NOPUB]"," "):""}}).filter("traduction",["$rootScope",function(a){return function(b,c){return("DESC"==b||"ASC"==b)&&(b=c+"_"+b),"0"==b&&(b="1"),"undefined"==typeof b||"undefined"==typeof a.config.trad||"undefined"==typeof a.config.trad[b]?b:a.config.trad[b]}}]).filter("dedoublonne",function(){return function(a){if(void 0==a)return[];for(var b=[],c=[],d=0;d<a.length;d++)void 0==b[a[d]]&&(b[a[d]]=a[d],c.push(a[d]));return c}}).filter("formatTimestamp",function(){return function(a){var b=new Date(1e3*a);return b.getFullYear()+"-"+(b.getMonth()+1)+"-"+b.getDate()+" "+b.getHours()+":"+b.getMinutes()+":"+b.getSeconds()}}).filter("toEuros",function(){return function(a){return void 0==a||""==a||0==a?"":Number(a).toLocaleString("fr-FR",{minimumFractionDigits:0})+" €"}}),angular.module("appliMobileBatiActuApp").directive("errSrc",function(){return{link:function(a,b,c){b.bind("error",function(){c.src!=c.errSrc&&c.$set("src",c.errSrc)})}}}),angular.module("appliMobileBatiActuApp").controller("ArticleDetailsCtrl",["$scope","ArticleFactory","$routeParams","$location","configSite",function(a,b,c,d,e){a.article=!1,a.rubriques=!1,a.fabricants=!1,a.typesRealisation=!1,a.page=void 0==c.page?1:c.page,a.unArticle={},a.realisations_preferees=JSON.parse(localStorage.getItem("realisations_preferees")),$("#favoriInfoAdd").hide(),$("#favoriInfoDelete").hide(),b.getArticle(c.id).then(function(b){a.article=b[0],a.unArticle=a.fromJJson(a.article.zs_json)}),a.retourRecherche=function(a){void 0!=a?d.path(e.extConfig.data.configEntityType[a].path):d.path("/")},a.fromJJson=function(a){return angular.fromJson(a)},a.imgResize=function(a){var b=a.replace("medium","medium_auto/300-200-c");return b},a.imgResizeToBig=function(a){var b=a.replace("medium","big");return b},a.upperCaseFirstChar=function(a){var b=a.charAt(0).toUpperCase()+a.slice(1);return b},a.comptePage=function(a){return null==a||void 0==a?"":a.length+1},a.lienPhoto=function(a,b){var c;for(c=0;c<a.length;c++)if(parseInt(a[c].page)==b){var d=(a[c].photo.fichier1,a[c].taille);return{fichier:a[c].photo.fichier1,taille:d}}return{}},a.precSuiv=function(){var a,d=-1,e="",f="",g="",h="",i="",j="";if(b.articles){if(void 0==b.articles.items)return{};for(a=0;a<b.articles.items.length;a++)b.articles.items[a].id==c.id&&(d=a);return 0==d?void 0!=b.articles.items&&void 0!=b.articles.items[d+1]&&(h=b.articles.items[d+1].id,i=b.articles.items[d+1].label,j=void 0!=b.articles.items[d+1].sm_image_url&&void 0!=b.articles.items[d+1].sm_image_url[0]?b.articles.items[d+1].sm_image_url[0]:null):d==b.articles.items.length-1?void 0!=b.articles.items&&void 0!=b.articles.items[d-1]&&(e=b.articles.items[d-1].id,f=b.articles.items[d-1].label,g=void 0!=b.articles.items[d-1].sm_image_url&&void 0!=b.articles.items[d-1].sm_image_url[0]?b.articles.items[d-1].sm_image_url[0]:null):(void 0!=b.articles.items&&void 0!=b.articles.items[d-1]&&(e=b.articles.items[d-1].id,f=b.articles.items[d-1].label,g=void 0!=b.articles.items[d-1].sm_image_url&&void 0!=b.articles.items[d-1].sm_image_url[0]?b.articles.items[d-1].sm_image_url[0]:null),void 0!=b.articles.items&&void 0!=b.articles.items[d+1]&&(h=b.articles.items[d+1].id,i=b.articles.items[d+1].label,j=void 0!=b.articles.items[d+1].sm_image_url&&void 0!=b.articles.items[d+1].sm_image_url[0]?b.articles.items[d+1].sm_image_url[0]:null)),{idPrec:e,labelPrec:f,imgPrec:g,idSuiv:h,labelSuiv:i,imgSuiv:j}}return{}},a.pagePrecedente=function(b,e){a.int_val(a.page)>1&&d.path("/articles/"+c.id+"/"+(a.int_val(a.page)-1))},a.pageSuivante=function(b,e){a.int_val(a.page)<a.comptePage(e.TPage)&&d.path("/articles/"+c.id+"/"+(a.int_val(a.page)+1))},a.ajoutRealisationPreferee=function(b){null==a.realisations_preferees&&(a.realisations_preferees={}),"undefined"==typeof a.realisations_preferees[b.entity_id]?(a.realisations_preferees[b.entity_id]=b,$("#ajout-real-favoris").text("Retirer cette réalisation des favoris"),$("#favoriInfoAdd").fadeIn(),setTimeout(function(){$("#favoriInfoAdd").fadeOut()},1500)):(delete a.realisations_preferees[b.entity_id],$("#ajout-real-favoris").text("Ajouter cette réalisation aux favoris"),$("#favoriInfoDelete").fadeIn(),setTimeout(function(){$("#favoriInfoDelete").fadeOut()},1500)),localStorage.setItem("realisations_preferees",JSON.stringify(a.realisations_preferees))}}]),angular.module("appliMobileBatiActuApp").controller("ArticlesCtrl",["$scope","$log","$location","$route","ArticleFactory","$filter","$anchorScroll","configSite","configFiltre","LoginFactory",function(a,b,c,d,e,f,g,h,i,j){a.articles=!1,a.nb_page=0,a.ws=!1,a.factory=e,a.$location=c,a.$log=b,a.filter=i.filtre,"/home"==c.path()&&delete a.filter.entity_type;var k=function(){console.log("getListe from ArticlesCtrl"),e.getCommonArticles(i,a.filter,function(b){a.articles=b.items,a.facets=b.facets,a.ws=b})};i.getListe=k,a.titreHome="Liste des articles / annonces",a.sousTitreHome="Découvrez ici toutes les informations de Batiactu Groupe.",angular.forEach(h.extConfig.data.configEntityType,function(b,d){c.path()==b.path&&(angular.forEach(a.filter,function(b,c){delete a.filter[c]}),a.filter.entity_type=d,a.filter.sort_order=b.sort_order,a.filter.sort=b.sort,a.filter.manual=b.manualFilter,a.titreHome=b.titreHome,a.sousTitreHome=b.sousTitreHome)}),k(),a.search=function(){""==a.filter.keywords&&delete a.filter.keywords,k()},a.showFilter=function(a){return-1===h.extConfig.data.configGen.filterNotVisible.indexOf(a)},a.filterPage=function(b){a.filter.page=b,k(),c.hash("top"),g()},a.fixText=function(a,b){return a.substr(0,b)+"..."},a.URL=e.URL+"&DEBUG=1"}]),angular.module("appliMobileBatiActuApp").controller("PubCtrl",["$scope","$log","PubFactory",function(a,b,c){a.pubs=!1,a.pubFactory=c,a.$log=b}]),angular.module("appliMobileBatiActuApp").controller("FiltreCtrl",["$scope","$location","$aside",function(a,b,c){var d=null;a.$location=b,a.toogle=function(){d=c.open({templateUrl:"views/aside.html",controller:"FiltreCtrl",placement:"left",size:"xs"})}}]),angular.module("appliMobileBatiActuApp").controller("LoginCtrl",["$scope","$location","$http","configSite","synchro","baLogs","LoginFactory",function(a,b,c,d,e,f,g){a.deconnexion=function(){d.profile={authentificated:!1},e.storageDel("login"),b.path("/login")}}]),angular.module("appliMobileBatiActuApp").controller("ConnexionCtrl",["$scope","configSite","$location","LoginFactory",function(a,b,c,d){a.user={login:"",password:""},a.identification=function(){b.profile.login=a.user.login,b.profile.password=a.user.password,d.login().then(function(a){c.path("/")})}}]),angular.module("appliMobileBatiActuApp").controller("InscriptionCtrl",["$scope","configSite","LoginFactory","$location",function(a,b,c,d){a.user={nom:"",prenom:"",email:"",login:"",pass1:"",pass2:""},a.inscription=function(){c.setProfile({authentificated:!0,userId:"0000",nom:a.user.nom,prenom:a.user.prenom,status:0,token:0,login:b.profile.login,email:b.profile.email,password:b.profile.password}),d.path("/")}}]),angular.module("appliMobileBatiActuApp").controller("MotdepasseoublieCtrl",["$scope","$location","$http","configSite","synchro","baLogs",function(a,b,c,d,e,f){var g=a.connexion=[];g.push({image:"images/image6.jpg"}),a.image_connexion="images/image6.jpg",a.mdpoublie=function(){var a={etat:"OK"};"OK"==a.etat?b.path("/connexion"):$("#erreur-connexion").removeClass("hide")}}]),angular.module("appliMobileBatiActuApp").controller("SliderCtrl",["$scope",function(a){var b=window.innerWidth,c=window.innerHeight,d=(window.orientation,$("ul[rn-carousel]").css("height"));if("0px"==d){$("ul[rn-carousel]").css("height",c),$("ul[rn-carousel]").css("width",b);var e=function(){90==Math.abs(window.orientation)?($("ul[rn-carousel]").css("height",b),$("ul[rn-carousel]").css("width",c)):($("ul[rn-carousel]").css("height",c),$("ul[rn-carousel]").css("width",b))};$(window).off("orientationchange"),$(window).bind("orientationchange",e)}var f="",g=a.slides=[];g.push({id:1,icon:"fa-calculator",image:f+"images/image7.jpg",text:"Informations"}),g.push({id:2,icon:"fa-list-alt ",image:f+"images/snow-1185474_1280.jpg",text:"Accédez à vos groupes"}),g.push({id:3,icon:"fa-camera",image:f+"images/sunset-477857_1280.jpg",text:"Accédez à  vos réalisations"}),g.push({id:4,icon:"fa-calculator",image:f+"images/ice-1160261_1280.jpg",text:"Tissez des liens"})}]),angular.module("appliMobileBatiActuApp").controller("CompteCtrl",["$scope","configSite",function(a,b){var c=0;a.cpt=function(){c++,c>10&&(b.logs.viewLogs=!0,b.logs.debug=!0)}}]),angular.module("appliMobileBatiActuApp").controller("FilActuCtrl",["$scope","ArticleFactory","$filter","$anchorScroll","configFiltre","FilActuFactory","ConfigFactory",function(a,b,c,d,e,f,g){a.articles=!1,a.nb_page=0,a.ws=!1,a.filter=e.filtreFilactu;var h=g.getEntityTypeNameList("facetList",!0),i=f.getUserPref();a.pref_user=f.checkEntityTypeInList(i),console.log(h);var j=!0;e.remove("manual","filtreFilactu"),angular.forEach(h,function(b){angular.forEach(b.value,function(c){angular.forEach(a.pref_user[c],function(d){j?a.filter.manual=g.getEntityTypeName(b.entityType,"filtre_"+c)+':"'+d+'"':a.filter.manual+=" OR "+g.getEntityTypeName(b.entityType,"filtre_"+c)+':"'+d+'"',j=!1})})}),console.log(a.filter.manual);var k=function(){console.log("getListe from FilActuCtrl"),b.getCommonArticles(e,a.filter,function(b){a.articles=b.items,a.facets=b.facets,a.ws=b})};e.getListe=k,k(),a.search=function(b){""==a.filter.keywords&&delete a.filter.keywords,k()},a.filterPage=function(b){a.filter.page=b,k()}}]),angular.module("appliMobileBatiActuApp").controller("GestionFilActuCtrl",["$scope","FilActuFactory","FonctionsFactory","ConfigFactory","baLogs",function(a,b,c,d,e){$("#favoriInfoAdd").hide(),$("#favoriInfoDelete").hide();var f={},g=d.getEntityTypeNameList("facetList"),h=b.getUserPref();a.pref_user=b.checkEntityTypeInList(h),f=b.checkEntityTypeInList(f);var i=function(){angular.forEach(g,function(b){angular.forEach(b,function(b){f[b]=j(b,a.facets[b])})})};b.getAllFacets().then(function(b){a.facets=b,i()}),a.getFacet=function(a){return f[a]};var j=function(b,d){var e=[];angular.forEach(d,function(c){-1==a.pref_user[b].indexOf(c.name)&&e.push(c)});var f=c.triFavoris(e),g=[];return angular.forEach(a.pref_user[b],function(a){var b={checked:!0,name:a};g.push(b)}),g=c.triFavoris(g),g=g.concat(f)};a.addToFav=function(c,d){if(-1==a.pref_user[c].indexOf(d))a.pref_user[c].push(d),e.notif_success(c+" : "+d+"<br> &agrave; bien &eacute;t&eacute; ajout&eacute; dans vos prvferences.");else{console.log("INDEX OFFFF",a.pref_user[c].indexOf(d));var g=a.pref_user[c].indexOf(d);a.pref_user[c].splice(g,1),e.notif_warning(c+" : "+d+"<br> &agrave; bien &eacute;t&eacute; supprim&eacute; de vos pr&eacute;ferences.")}f[c]=j(c,a.facets[c]),b.setUserPref(a.pref_user)},a.deletePrefs=function(){e.notif_warning("Toutes vos pr&eacute;ferences ont bien &eacute;t&eacute; supprim&eacute;es."),b.delAllUserPref(),a.pref_user=b.checkEntityTypeInList({}),i()}}]),angular.module("appliMobileBatiActuApp").controller("ProfilCtrl",function(){}),angular.module("appliMobileBatiActuApp").controller("GestionCtrl",["$scope","$location","$route","configSite","baPush","PushFactory","configFiltre",function(a,b,c,d,e,f,g){a.filter=g.filtre,a.videEntity=function(){g.noRefresh().remove(["entity_type","rubrique","theme","fabricant","type_realisation","keywords"]),"/home"==b.path()?c.reload():b.path("/home")},a.registerPush=function(){var a=e.init();null!=a&&(a.on("registration",f.registrationHandler),a.on("notification",f.notificationHandler),a.on("error",f.errorHandler))},a.unRegisterPush=function(){e.unRegisterPush(f.unRegisterPushHandler)}}]),angular.module("appliMobileBatiActuApp").controller("GroupesCtrl",["$scope","$log","$location","$route","$filter","$anchorScroll","$routeParams","configFiltre","ArticleFactory","synchro",function(a,b,c,d,e,f,g,h,i,j){a.groupe=!1,a.groupes=!1,a.categories=!1,a.nb_page=0,a.ws=!1,a.$location=c,a.$log=b,a.filter=h.filtreGroupe;var k=j.cache.get("categories",!1);null!=k&&(a.categories=k);var l=function(){console.log("getListe from GroupesCtrl"),i.getCommonArticles(h,a.filter,function(b){a.groupes=b.items,a.ws=b,"undefined"==typeof a.filter.categorie&&(a.categories=b.facets.categorie,j.cache.set("categories",a.categories,600))})};h.getListe=l,l(),a.getInitials=function(a){for(var b=[],c=0;c<a.split(" ").length;c++)b.push(a.split(" ")[c].substr(0,1).toUpperCase()+".");return void 0!==b[1]&&void 0==b[2]?b[0]+b[1]:void 0!==b[1]&&void 0!==b[2]?b[0]+b[1]+b[2]:b[0]}}]),angular.module("appliMobileBatiActuApp").controller("RealisationsCtrl",["$scope","$log","$location","$route","ArticleFactory","configFiltre",function(a,b,c,d,e,f){a.articles=!1,a.types_realisation=!1,a.types_travaux=!1,console.log("filter realisation ",a.filter),a.filter=f.filtreRealisation,a.filter.entity_type="reseau_realisation";var g=function(){console.log("getListe from RealisationsCtrl"),e.getCommonArticles(f,a.filter,function(b){a.articles=b.items,a.facets=b.facets,a.ws=b})};f.getListe=g,g(),a.listeMois=["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"];var h=function(){for(var a=(new Date).getFullYear(),b=[],c=a;c>=2e3;c--)b.push(c);return b};a.listeAnnees=h()}]),angular.module("appliMobileBatiActuApp").controller("DiscussionsCtrl",["$scope",function(a){}]),angular.module("appliMobileBatiActuApp").controller("MonReseauCtrl",["$scope","LoginFactory",function(a,b){var c={};b.getMesGroupes().then(function(a){console.log("DDDDDDDDDDDDDDDDDDDDDDDDD",a),c=a}),console.log("DANS CONTROLEUR MonReseauCtrl"),a.mesGroupes=function(){return c}}]),angular.module("appliMobileBatiActuApp").controller("MaterielCtrl",["$scope",function(a){var b=function(a){var b={marque:{label:"Marque"},modele:{label:"Modèle"},annee:{label:"Annee"},heure:{label:"Heure"},etat:{label:"Etat",convert:{1:"Neuf",2:"Très bon",3:"Bon",4:"Prévoir réparations",5:"Pour pièces détachées"}},fleches:{label:"Flèches",unite:"m"},puissance_ch:{label:"Puissance ch",unite:"ch"},puissance_kva:{label:"Puissance electrique kva",unite:"kVA"},capacite:{label:"Capacité",unite:"kgs"},kilometrage:{label:"Kilométrage",unite:"km"},marque_porteur:{label:"Marque porteur"},modele_porteur:{label:"Modèle porteur"},ptac:{label:"PTAC",unite:"kgs"},surface:{label:"Surface",unite:"m<sup>2</sup>"},ouverture_alim:{label:"Ouverture d'alimentation",unite:"mm"},nb_etages:{label:"Nombre d'étages"},debit_air:{label:"Débit d'air",unite:"l/min"},type_mat:{label:"Type de mât"},capacite_levage:{label:"Capacité de levage",unite:"kgs"},hauteur_levage:{label:"Hauteur de levage",unite:"m"},hauteur_travail:{label:"Hauteur de travail",unite:"m"},date_mec:{label:"Date de 1ère mise en circulation"},couple_levage:{label:"Couple de levage",unite:"Kgs/m"},type_energie:{label:"Type d'énergie",convert:{1:"Diesel",2:"Gaz",3:"Essence",4:"Electrique",5:"Autre"}}},c=[];return angular.forEach(b,function(b,d){if("object"==typeof a&&"undefined"!=a[d]&&""!=a[d]){var e={infos:b,value:a[d]};c.push(e)}}),c};a.getPriceAndUnit=function(a,b){var c={0:"&euro;",1:"&euro;",2:"$",3:"£",4:"руб"};return void 0==a||""==a||0==a?"Non indiqu&eacute;":Number(a).toLocaleString("fr-FR",{minimumFractionDigits:0})+" "+c[b]},a.getLabel=function(a){return a.label},a.getValue=function(a,b){return void 0!==b.convert?b.convert[a]:a};var c=b(a.unArticle);a.getParamsAnnonce=function(){return c},a.prefixe_url_image="http://materiel.batiactu.com/uploads/photo_"}]),angular.module("appliMobileBatiActuApp").controller("DemandeDocCtrl",["$scope","ArticleFactory","$log","$routeParams","$route","$filter","$location",function(a,b,c,d,e,f,g){a.retourRecherche=function(b){g.path("/articles/"+a.article.id)}}]),jQuery(document).ready(function(){if(document.addEventListener("deviceready",function(){var a=document.body;angular.bootstrap(a,["appliMobileBatiActuApp"],{strictDi:!0})},!1),"undefined"==typeof window.cordova){var a=document.body;angular.bootstrap(a,["appliMobileBatiActuApp"],{strictDi:!0})}jQuery().UItoTop({easingType:"easeOutQuart"})});